(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6960],{55555:()=>{},59031:(e,a,s)=>{"use strict";s.d(a,{N:()=>r});var t=s(82427);async function r(e){try{return(await t.A.get("/properties/".concat(e))).data}catch(e){throw e}}},68082:(e,a,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/p2p/offers",function(){return s(76800)}])},76800:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>h});var t=s(37876),r=s(14232),l=s(59031),i=s(82427);async function c(){try{return(await i.A.get("/p2p/listings")).data}catch(e){throw e}}async function n(e){try{return(await i.A.post("/p2p-transactions",e)).data}catch(e){throw e}}var d=s(89848),o=s(23230);s(42730);var m=s(59511),x=s(89099);function h(){let[e,a]=(0,r.useState)([]),[s,i]=(0,r.useState)(null),[h,u]=(0,r.useState)(!0),[f,p]=(0,r.useState)({}),[j,N]=(0,r.useState)(new Set),{user:b,isAuthenticated:v}=function(){let[e,a]=(0,r.useState)(null),[s,t]=(0,r.useState)(!0),[l,i]=(0,r.useState)(!1),c=(0,x.useRouter)(),n=()=>{{let e=localStorage.getItem("token")||localStorage.getItem("admin_token");if(e)try{let a=JSON.parse(atob(e.split(".")[1])),s=Math.floor(Date.now()/1e3);if(a.exp&&a.exp<s)return null;return{id:a.id||a.user_id||a.sub,email:a.email,name:a.name||a.username,exp:a.exp}}catch(e){}}return null},d=(0,r.useCallback)(()=>{let e=n();e?(a(e),i(!0)):(a(null),i(!1)),t(!1)},[]),o=(0,r.useCallback)(()=>{localStorage.removeItem("token"),localStorage.removeItem("admin_token"),a(null),i(!1),c.push("/login")},[c]);return(0,r.useEffect)(()=>{d()},[d]),(0,r.useEffect)(()=>{let e=setInterval(()=>{!n()&&l&&o()},3e4);return()=>clearInterval(e)},[l,o]),{user:e,isLoading:s,isAuthenticated:l,logout:o,checkAuth:d}}();(0,r.useEffect)(()=>{(async()=>{if(v&&b)try{let e=await c(),s=e.data||e||[];if(console.log("Ofertas recebidas:",s),console.log("Estrutura da resposta:",e),!Array.isArray(s)){console.error("Dados recebidos n\xe3o s\xe3o um array:",s),i("Formato de dados inv\xe1lido recebido do servidor.");return}let t=[...new Set(s.map(e=>e.id_imovel))],r={};await Promise.all(t.map(async e=>{try{let a=await (0,l.N)(e);r[e]=a}catch(a){console.error("Erro ao buscar im\xf3vel ".concat(e,":"),a)}})),p(r),a(s)}catch(e){console.error("Erro ao carregar ofertas:",e),i("Erro ao carregar ofertas.")}finally{u(!1)}})()},[v,b]);let g=async e=>{if(!b||!b.id)return void d.oR.warning("Voc\xea precisa estar logado para comprar tokens.");N(a=>new Set([...a,e]));try{await n({listing_id:e,comprador_id:b.id}),d.oR.success("Compra realizada com sucesso! Os tokens foram adicionados \xe0 sua carteira.");let s=await c(),t=s.data||s||[];a(t)}catch(e){console.error(e),d.oR.error("Erro ao processar a compra. Tente novamente.")}finally{N(a=>{let s=new Set(a);return s.delete(e),s})}},w=e.filter(e=>e.vendedor_id===(null==b?void 0:b.id)),y=e.filter(e=>e.vendedor_id!==(null==b?void 0:b.id));function k(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=f[e.id_imovel]||{},r=Number(e.valor_unitario)*Number(e.qtd_tokens),l="ativa"===e.status,i=j.has(e.id);return(0,t.jsxs)("div",{className:"card h-100 border-0 shadow-sm hover-shadow-lg transition-all",children:[(0,t.jsxs)("div",{className:"position-absolute",style:{top:"12px",right:"12px",zIndex:1},children:[a&&(0,t.jsxs)("span",{className:"badge bg-info text-white mb-2 d-block",children:[(0,t.jsx)("i",{className:"fa fa-user me-1"}),"Minha Oferta"]}),(0,t.jsxs)("span",{className:"badge ".concat(l?"bg-success":"bg-secondary"),children:[(0,t.jsx)("i",{className:"fa ".concat(l?"fa-check-circle":"fa-pause-circle"," me-1")}),e.status.charAt(0).toUpperCase()+e.status.slice(1)]})]}),(0,t.jsxs)("div",{className:"position-relative overflow-hidden",style:{height:"200px"},children:[(0,t.jsx)("img",{src:s.imagem_url||"/assets/img/default-property.jpg",alt:s.titulo||"Im\xf3vel",className:"w-100 h-100 object-fit-cover",onError:e=>{e.target.src="/assets/img/default-property.jpg"}}),(0,t.jsxs)("div",{className:"position-absolute bottom-0 start-0 w-100 bg-gradient-dark p-3",children:[(0,t.jsxs)("h6",{className:"text-white mb-1 fw-semibold",children:[(0,t.jsx)("i",{className:"fa fa-home me-2"}),s.titulo||"Im\xf3vel"]}),(0,t.jsxs)("small",{className:"text-white-50",children:[(0,t.jsx)("i",{className:"fa fa-map-marker-alt me-1"}),s.localizacao||"Localiza\xe7\xe3o n\xe3o informada"]})]})]}),(0,t.jsxs)("div",{className:"card-body d-flex flex-column",children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,t.jsxs)("small",{className:"text-muted",children:["Oferta #",e.id]}),(0,t.jsxs)("small",{className:"badge bg-light text-dark",children:[e.qtd_tokens," tokens"]})]}),(0,t.jsxs)("div",{className:"row g-2 mb-3",children:[(0,t.jsx)("div",{className:"col-6",children:(0,t.jsxs)("div",{className:"bg-light rounded p-2 text-center",children:[(0,t.jsxs)("div",{className:"fw-bold text-primary h6 mb-0",children:["R$ ",Number(e.valor_unitario).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),(0,t.jsx)("small",{className:"text-muted",children:"Por token"})]})}),(0,t.jsx)("div",{className:"col-6",children:(0,t.jsxs)("div",{className:"bg-light rounded p-2 text-center",children:[(0,t.jsxs)("div",{className:"fw-bold text-success h6 mb-0",children:["R$ ",r.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),(0,t.jsx)("small",{className:"text-muted",children:"Total"})]})})]})]}),(0,t.jsx)("div",{className:"mt-auto",children:a?(0,t.jsxs)("div",{className:"d-grid gap-2",children:[(0,t.jsxs)("button",{className:"btn btn-outline-primary btn-sm",disabled:!0,children:[(0,t.jsx)("i",{className:"fa fa-eye me-2"}),"Gerenciar Oferta"]}),(0,t.jsxs)("small",{className:"text-center text-muted",children:[(0,t.jsx)("i",{className:"fa fa-info-circle me-1"}),"Aguardando compradores"]})]}):(0,t.jsxs)("div",{className:"d-grid",children:[(0,t.jsx)("button",{className:"btn ".concat(l?"btn-success":"btn-secondary"," btn-sm"),onClick:()=>g(e.id),disabled:!l||i,children:i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Processando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"fa ".concat(l?"fa-shopping-cart":"fa-lock"," me-2")}),l?"Comprar Agora":"Indispon\xedvel"]})}),l&&!i&&(0,t.jsxs)("small",{className:"text-center text-muted mt-1",children:[(0,t.jsx)("i",{className:"fa fa-shield-alt me-1"}),"Transa\xe7\xe3o segura"]})]})})]})]})}return(0,t.jsx)(m.A,{children:(0,t.jsxs)("div",{className:"container-fluid py-4",children:[(0,t.jsx)(o.A,{items:[{label:"P2P",path:"#"},{label:"Ofertas",path:"/p2p/offers"}]}),(0,t.jsx)("div",{className:"row mb-4",children:(0,t.jsx)("div",{className:"col-12",children:(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-2xl mb-2 text-dark fw-bold",children:[(0,t.jsx)("i",{className:"fa fa-handshake me-3 text-primary"}),"Marketplace P2P"]}),(0,t.jsx)("p",{className:"text-muted mb-0",children:"Compre e venda tokens de im\xf3veis diretamente com outros investidores"})]}),(0,t.jsxs)("div",{className:"d-flex gap-3",children:[(0,t.jsxs)("div",{className:"card border-0 bg-light-primary p-3 text-center",children:[(0,t.jsx)("div",{className:"h5 mb-1 text-primary fw-bold",children:e.length}),(0,t.jsx)("small",{className:"text-muted",children:"Total de Ofertas"})]}),(0,t.jsxs)("div",{className:"card border-0 bg-light-success p-3 text-center",children:[(0,t.jsx)("div",{className:"h5 mb-1 text-success fw-bold",children:y.length}),(0,t.jsx)("small",{className:"text-muted",children:"Para Comprar"})]}),(0,t.jsxs)("div",{className:"card border-0 bg-light-info p-3 text-center",children:[(0,t.jsx)("div",{className:"h5 mb-1 text-info fw-bold",children:w.length}),(0,t.jsx)("small",{className:"text-muted",children:"Suas Ofertas"})]})]})]})})}),h&&(0,t.jsxs)("div",{className:"text-center py-5",children:[(0,t.jsx)("div",{className:"spinner-border text-primary mb-3",role:"status",children:(0,t.jsx)("span",{className:"visually-hidden",children:"Carregando..."})}),(0,t.jsx)("p",{className:"text-muted",children:"Carregando ofertas dispon\xedveis..."})]}),s&&(0,t.jsxs)("div",{className:"alert alert-danger d-flex align-items-center mb-4",role:"alert",children:[(0,t.jsx)("i",{className:"fa fa-exclamation-triangle me-2"}),(0,t.jsx)("div",{children:s})]}),!h&&!s&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("div",{className:"row",children:(0,t.jsx)("div",{className:"col-12",children:(0,t.jsxs)("div",{className:"card border-0 shadow-sm",children:[(0,t.jsxs)("div",{className:"card-header bg-primary text-white d-flex align-items-center",children:[(0,t.jsx)("i",{className:"fa fa-handshake me-2"}),(0,t.jsx)("h5",{className:"mb-0",children:"Ofertas do Marketplace"}),(0,t.jsx)("span",{className:"badge bg-light text-primary ms-auto",children:e.length})]}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col-md-6 col-xl-4 mb-4",children:(0,t.jsx)("div",{className:"card h-100 border-2 border-dashed border-primary hover-shadow-lg transition-all",children:(0,t.jsxs)("div",{className:"card-body d-flex flex-column justify-content-center align-items-center text-center p-5",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("i",{className:"fa fa-plus-circle fa-4x text-primary opacity-75"})}),(0,t.jsx)("h6",{className:"text-primary fw-bold mb-2",children:"Criar Nova Oferta"}),(0,t.jsx)("p",{className:"text-muted mb-4 small",children:"Coloque seus tokens \xe0 venda no marketplace P2P"}),(0,t.jsxs)("button",{className:"btn btn-primary btn-sm px-4",onClick:()=>window.location.href="/p2p/new_offer",children:[(0,t.jsx)("i",{className:"fa fa-plus me-2"}),"Criar Oferta"]})]})})}),w.map(e=>(0,t.jsx)("div",{className:"col-md-6 col-xl-4 mb-4",children:k(e,!0)},e.id)),y.map(e=>(0,t.jsx)("div",{className:"col-md-6 col-xl-4 mb-4",children:k(e,!1)},e.id)),0===e.length&&(0,t.jsx)("div",{className:"col-12",children:(0,t.jsxs)("div",{className:"text-center py-5",children:[(0,t.jsx)("i",{className:"fa fa-search fa-3x text-muted mb-3"}),(0,t.jsx)("h6",{className:"text-muted",children:"Nenhuma oferta dispon\xedvel no momento"}),(0,t.jsx)("p",{className:"text-muted",children:"Seja o primeiro a criar uma oferta no marketplace!"})]})})]})})]})})})})]})})}s(55555)}},e=>{var a=a=>e(e.s=a);e.O(0,[1040,9489,636,6593,8792],()=>a(68082)),_N_E=e.O()}]);
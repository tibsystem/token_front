(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6749],{24440:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>h});var o=t(37876),l=t(14232),r=t(82427);async function s(e){try{return(await r.A.post("/properties",e)).data}catch(e){throw e}}var n=t(98928),i=t(56856);t(36556);var c=t(11890),d=t(54587),m=t.n(d),u=t(89848),p=t(59511);function h(){let[e,a]=(0,l.useState)({titulo:"",descricao:"",localizacao:"",valor_total:"",qtd_tokens:"",modelo_smart_id:"",status:"ativo",data_tokenizacao:new Date().toISOString().slice(0,10)}),[t,r]=(0,l.useState)(""),[c,d]=(0,l.useState)({logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",uf:"",cep:""}),[h,g]=(0,l.useState)(!1),[x,v]=(0,l.useState)(""),[f,j]=(0,l.useState)(new Date),[b,N]=(0,l.useState)(!1),[y,_]=(0,l.useState)(!1),[k,S]=(0,l.useState)(""),[w,C]=(0,l.useState)([]),[I,E]=(0,l.useState)([]),R=t=>{a({...e,[t.target.name]:t.target.value})},q=async e=>{let t=e.replace(/\D/g,"");if(8!==t.length)return void v("CEP deve ter 8 d\xedgitos");g(!0),v("");try{let o=await fetch("https://viacep.com.br/ws/".concat(t,"/json/")),l=await o.json();if(l.erro)return void v("CEP n\xe3o encontrado");let r={logradouro:l.logradouro||"",numero:"",complemento:"",bairro:l.bairro||"",cidade:l.localidade||"",uf:l.uf||"",cep:e};d(r);let s="".concat(r.logradouro,", ").concat(r.bairro,", ").concat(r.cidade," - ").concat(r.uf,", CEP: ").concat(e);a(e=>({...e,localizacao:s})),u.oR.success("CEP encontrado com sucesso!")}catch(e){v("Erro ao buscar CEP"),u.oR.error("Erro ao buscar CEP")}finally{g(!1)}},P=e=>{let a=e.replace(/\D/g,"");return a.length<=5?a:"".concat(a.slice(0,5),"-").concat(a.slice(5,8))},D=(e,t)=>{let o={...c,[e]:t};d(o);let l="".concat(o.logradouro).concat(o.numero?", "+o.numero:"").concat(o.complemento?", "+o.complemento:"",", ").concat(o.bairro,", ").concat(o.cidade," - ").concat(o.uf,", CEP: ").concat(o.cep);a(e=>({...e,localizacao:l}))},z=e=>{let a=e.replace(/\D/g,"");return a?(parseInt(a)/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):""},F=e=>e&&parseFloat(e.replace(/[R$\s]/g,"").replace(/\./g,"").replace(",","."))||0,A=e=>{C(a=>a.filter((a,t)=>t!==e)),E(a=>a.filter((a,t)=>t!==e))},L=async t=>{t.preventDefault(),N(!0),S(""),_(!1);try{if(0===w.length){u.oR.warning("Nenhuma imagem selecionada. Adicione pelo menos uma imagem."),N(!1);return}let t=new FormData,o=F(e.valor_total);for(let[a,l]of(t.append("titulo",e.titulo),t.append("descricao",e.descricao),t.append("localizacao",e.localizacao),t.append("valor_total",o),t.append("qtd_tokens",parseInt(e.qtd_tokens)),t.append("modelo_smart_id",e.modelo_smart_id),t.append("status",e.status),t.append("data_tokenizacao",e.data_tokenizacao),w.forEach((e,a)=>{t.append("imagens",e)}),t.entries()))File;try{await s(t)}catch(e){try{await B(t)}catch(e){Array.from(t.keys()).forEach(e=>{e.includes("imagens")&&t.delete(e)}),w.forEach(e=>{t.append("imagens[]",e)}),await s(t)}}_(!0),u.oR.success("Im\xf3vel cadastrado com sucesso!"),a({titulo:"",descricao:"",localizacao:"",valor_total:"",qtd_tokens:"",modelo_smart_id:"",status:"ativo",data_tokenizacao:new Date().toISOString().slice(0,10)}),r(""),d({logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",uf:"",cep:""}),j(new Date),C([]),E([])}catch(e){e&&"object"==typeof e&&"message"in e?S(e.message):S("Erro ao cadastrar im\xf3vel"),u.oR.error("Erro ao cadastrar im\xf3vel")}finally{N(!1)}},B=async e=>(Array.from(e.keys()).forEach(a=>{a.includes("imagens")&&e.delete(a)}),w.forEach((a,t)=>{e.append("imagens[".concat(t,"]"),a)}),await s(e));return(0,o.jsx)(p.A,{children:(0,o.jsx)("div",{className:"container max-w-5xl mx-auto mt-8 p-4",children:(0,o.jsxs)("div",{className:"card shadow-lg border-0 rounded-4 p-5 animate__animated animate__fadeIn",children:[(0,o.jsxs)("h2",{className:"text-3xl fw-bold mb-5 text-primary d-flex align-items-center gap-2",children:[(0,o.jsx)(n.rQ8,{className:"text-primary"})," Cadastro de Im\xf3vel"]}),(0,o.jsxs)("form",{onSubmit:L,className:"row g-4",children:[(0,o.jsxs)("div",{className:"col-md-6",children:[(0,o.jsxs)("div",{className:"form-floating mb-4",children:[(0,o.jsx)("input",{type:"text",className:"form-control",name:"titulo",id:"titulo",placeholder:"T\xedtulo",value:e.titulo,onChange:R,required:!0}),(0,o.jsxs)("label",{htmlFor:"titulo",children:[(0,o.jsx)(n.rQ8,{className:"me-2"})," T\xedtulo"]})]}),(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsxs)("label",{className:"form-label d-flex align-items-center gap-2",children:[(0,o.jsx)(n.vq8,{})," CEP"]}),(0,o.jsxs)("div",{className:"input-group",children:[(0,o.jsx)("input",{type:"text",className:"form-control ".concat(x?"is-invalid":""),placeholder:"00000-000",value:t,onChange:e=>{let a=e.target.value,t=P(a);r(t),8===a.replace(/\D/g,"").length&&q(t)},maxLength:9,required:!0}),(0,o.jsx)("button",{type:"button",className:"btn btn-outline-primary",onClick:()=>q(t),disabled:h||8!==t.replace(/\D/g,"").length,children:h?(0,o.jsx)(n.hW,{className:"fa-spin"}):(0,o.jsx)(n.KSO,{})}),x&&(0,o.jsx)("div",{className:"invalid-feedback",children:x})]}),(0,o.jsx)("small",{className:"text-muted",children:"Digite o CEP para preenchimento autom\xe1tico do endere\xe7o"})]}),c.logradouro&&(0,o.jsxs)("div",{className:"row g-3 mb-4",children:[(0,o.jsx)("div",{className:"col-md-8",children:(0,o.jsxs)("div",{className:"form-floating",children:[(0,o.jsx)("input",{type:"text",className:"form-control",value:c.logradouro,onChange:e=>D("logradouro",e.target.value),placeholder:"Logradouro"}),(0,o.jsx)("label",{children:"Logradouro"})]})}),(0,o.jsx)("div",{className:"col-md-4",children:(0,o.jsxs)("div",{className:"form-floating",children:[(0,o.jsx)("input",{type:"text",className:"form-control",value:c.numero,onChange:e=>D("numero",e.target.value),placeholder:"N\xfamero",required:!0}),(0,o.jsx)("label",{children:"N\xfamero"})]})}),(0,o.jsx)("div",{className:"col-md-6",children:(0,o.jsxs)("div",{className:"form-floating",children:[(0,o.jsx)("input",{type:"text",className:"form-control",value:c.complemento,onChange:e=>D("complemento",e.target.value),placeholder:"Complemento"}),(0,o.jsx)("label",{children:"Complemento (opcional)"})]})}),(0,o.jsx)("div",{className:"col-md-6",children:(0,o.jsxs)("div",{className:"form-floating",children:[(0,o.jsx)("input",{type:"text",className:"form-control",value:c.bairro,onChange:e=>D("bairro",e.target.value),placeholder:"Bairro"}),(0,o.jsx)("label",{children:"Bairro"})]})}),(0,o.jsx)("div",{className:"col-md-8",children:(0,o.jsxs)("div",{className:"form-floating",children:[(0,o.jsx)("input",{type:"text",className:"form-control",value:c.cidade,onChange:e=>D("cidade",e.target.value),placeholder:"Cidade"}),(0,o.jsx)("label",{children:"Cidade"})]})}),(0,o.jsx)("div",{className:"col-md-4",children:(0,o.jsxs)("div",{className:"form-floating",children:[(0,o.jsx)("input",{type:"text",className:"form-control",value:c.uf,onChange:e=>D("uf",e.target.value.toUpperCase()),placeholder:"UF",maxLength:2}),(0,o.jsx)("label",{children:"UF"})]})})]}),e.localizacao&&(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("label",{className:"form-label",children:"Endere\xe7o Completo:"}),(0,o.jsx)("div",{className:"p-3 bg-light rounded border",children:(0,o.jsx)("small",{className:"text-muted",children:e.localizacao})})]}),(0,o.jsxs)("div",{className:"form-floating mb-4",children:[(0,o.jsx)("textarea",{className:"form-control h-auto",name:"descricao",id:"descricao",placeholder:"Descri\xe7\xe3o",value:e.descricao,onChange:R,style:{height:"130px"},required:!0}),(0,o.jsxs)("label",{htmlFor:"descricao",children:[(0,o.jsx)(n.Icq,{className:"me-2"})," Descri\xe7\xe3o"]})]}),(0,o.jsxs)("div",{className:"form-floating mb-4",children:[(0,o.jsx)("input",{type:"text",className:"form-control",name:"valor_total",id:"valor_total",placeholder:"Valor Total",value:e.valor_total,onChange:t=>{let o=z(t.target.value);a({...e,valor_total:o})},min:0,step:.01,required:!0}),(0,o.jsxs)("label",{htmlFor:"valor_total",children:[(0,o.jsx)(n.cEG,{className:"me-2"})," Valor Total (R$)"]})]})]}),(0,o.jsxs)("div",{className:"col-md-6",children:[(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsxs)("label",{className:"form-label d-flex align-items-center gap-2",children:[(0,o.jsx)(n.dkL,{})," Imagens do Im\xf3vel"]}),(0,o.jsxs)("div",{className:"border border-dashed border-2 border-primary rounded-3 p-4",children:[(0,o.jsxs)("div",{className:"text-center mb-3",children:[(0,o.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>{let a=Array.from(e.target.files);if(a.length+w.length>5)return void u.oR.error("M\xe1ximo 5 imagens permitidas");let t=["image/jpeg","image/jpg","image/png","image/webp"];return a.filter(e=>!t.includes(e.type)).length>0?void u.oR.error("Apenas arquivos JPEG, PNG e WEBP s\xe3o permitidos"):a.filter(e=>e.size>5242880).length>0?void u.oR.error("Cada imagem deve ter no m\xe1ximo 5MB"):void(C(e=>[...e,...a]),a.forEach(e=>{let a=new FileReader;a.onload=a=>{E(t=>[...t,{file:e,url:a.target.result,name:e.name}])},a.readAsDataURL(e)}))},className:"d-none",id:"imageUpload"}),(0,o.jsxs)("label",{htmlFor:"imageUpload",className:"btn btn-outline-primary btn-lg d-flex align-items-center justify-content-center gap-2 w-100",style:{cursor:"pointer"},children:[(0,o.jsx)(n.dkL,{}),"Selecionar Imagens (M\xe1x. 5)"]}),(0,o.jsx)("small",{className:"text-muted d-block mt-2",children:"Formatos aceitos: JPEG, PNG, WEBP (m\xe1x. 5MB cada)"})]}),I.length>0&&(0,o.jsxs)("div",{className:"border-top pt-3",children:[(0,o.jsxs)("h6",{className:"mb-3 text-center",children:["Imagens Selecionadas (",I.length,"/5)"]}),(0,o.jsx)("div",{className:"row g-2",children:I.map((e,a)=>(0,o.jsx)("div",{className:"col-6",children:(0,o.jsxs)("div",{className:"position-relative",children:[(0,o.jsx)(m(),{src:e.url,alt:"Preview ".concat(a+1),className:"img-fluid rounded-2 shadow-sm",style:{height:"100px",width:"100%",objectFit:"cover"},width:150,height:100}),(0,o.jsx)("button",{type:"button",className:"btn btn-danger btn-sm position-absolute top-0 end-0 m-1 rounded-circle d-flex align-items-center justify-content-center",style:{width:"24px",height:"24px"},onClick:()=>A(a),title:"Remover imagem",children:(0,o.jsx)(n.QCr,{size:10})}),(0,o.jsx)("div",{className:"mt-1",children:(0,o.jsx)("small",{className:"text-muted text-truncate d-block",title:e.name,children:e.name.length>15?e.name.substring(0,15)+"...":e.name})})]})},a))})]}),0===I.length&&(0,o.jsxs)("div",{className:"text-center text-muted py-3",children:[(0,o.jsx)(n.dkL,{size:40,className:"mb-2 opacity-50"}),(0,o.jsx)("p",{className:"mb-0",children:"Nenhuma imagem selecionada"}),(0,o.jsx)("small",{children:"Clique no bot\xe3o acima para adicionar imagens"})]})]})]}),(0,o.jsxs)("div",{className:"form-floating mb-4",children:[(0,o.jsx)("input",{type:"number",className:"form-control",name:"qtd_tokens",id:"qtd_tokens",placeholder:"Quantidade de Tokens",value:e.qtd_tokens,onChange:R,min:1,required:!0}),(0,o.jsxs)("label",{htmlFor:"qtd_tokens",children:[(0,o.jsx)(n.Icq,{className:"me-2"})," Quantidade de Tokens"]})]}),(0,o.jsxs)("div",{className:"form-floating mb-4",children:[(0,o.jsx)("input",{type:"text",className:"form-control",name:"modelo_smart_id",id:"modelo_smart_id",placeholder:"Modelo Smart ID",value:e.modelo_smart_id,onChange:R,required:!0}),(0,o.jsxs)("label",{htmlFor:"modelo_smart_id",children:[(0,o.jsx)(n.UIU,{className:"me-2"})," Modelo Smart ID"]})]}),(0,o.jsxs)("div",{className:"form-floating mb-4",children:[(0,o.jsxs)("select",{className:"form-select",name:"status",id:"status",value:e.status,onChange:R,required:!0,children:[(0,o.jsx)("option",{value:"ativo",children:"Ativo"}),(0,o.jsx)("option",{value:"inativo",children:"Inativo"})]}),(0,o.jsxs)("label",{htmlFor:"status",children:[(0,o.jsx)(n.A7C,{className:"me-2"})," Status"]})]}),(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsxs)("label",{className:"form-label d-flex align-items-center gap-2",children:[(0,o.jsx)(n.bfZ,{})," Data de Tokeniza\xe7\xe3o"]}),(0,o.jsx)(i.Ay,{selected:f,onChange:t=>{j(t),a({...e,data_tokenizacao:t?t.toISOString().slice(0,10):""})},dateFormat:"dd/MM/yyyy",placeholderText:"Selecione a data",className:"form-control py-2 px-3 border rounded shadow-sm",calendarClassName:"shadow rounded border",locale:"pt-BR",required:!0})]})]}),(0,o.jsx)("div",{className:"col-12",children:(0,o.jsxs)("button",{type:"submit",className:"btn btn-primary btn-lg w-100 d-flex align-items-center justify-content-center gap-2",disabled:b,children:[b?(0,o.jsx)("span",{className:"spinner-border spinner-border-sm"}):(0,o.jsx)(n.A7C,{}),b?"Cadastrando...":"Cadastrar Im\xf3vel"]})})]})]})})})}(0,i.E)("pt-BR",c.F),(0,i.YC)("pt-BR")},36963:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/properties/register",function(){return t(24440)}])},59511:(e,a,t)=>{"use strict";t.d(a,{A:()=>n});var o=t(37876),l=t(14232),r=t(89099),s=t(89848);function n(e){let{children:a}=e,[t,n]=(0,l.useState)(!1),[i,c]=(0,l.useState)(!0),d=(0,r.useRouter)();return((0,l.useEffect)(()=>{(()=>{{let e=localStorage.getItem("token")||localStorage.getItem("admin_token"),a=localStorage.getItem("admin_token")?"/admin/login":"/login";if(!e){s.oR.warning("Sua sess\xe3o expirou. Por favor, fa\xe7a login novamente."),d.push(a);return}try{let t=JSON.parse(atob(e.split(".")[1])),o=Math.floor(Date.now()/1e3);if(t.exp&&t.exp<o){localStorage.removeItem("token"),localStorage.removeItem("admin_token"),s.oR.warning("Sua sess\xe3o expirou. Por favor, fa\xe7a login novamente."),d.push(a);return}n(!0)}catch(e){console.error("Erro ao validar token:",e),localStorage.removeItem("token"),localStorage.removeItem("admin_token"),s.oR.error("Token inv\xe1lido. Por favor, fa\xe7a login novamente."),d.push(a)}finally{c(!1)}}})();let e=setInterval(()=>{let e=localStorage.getItem("token")||localStorage.getItem("admin_token"),a=localStorage.getItem("admin_token")?"/admin/login":"/login";if(e)try{let t=JSON.parse(atob(e.split(".")[1])),o=Math.floor(Date.now()/1e3);t.exp&&t.exp<o&&(localStorage.removeItem("token"),localStorage.removeItem("admin_token"),localStorage.removeItem("profileData"),s.oR.warning("Sua sess\xe3o expirou. Por favor, fa\xe7a login novamente."),d.push(a))}catch(e){localStorage.removeItem("token"),localStorage.removeItem("admin_token"),d.push(a)}},3e4);return()=>clearInterval(e)},[d]),(0,l.useEffect)(()=>{let e=e=>{if(("token"===e.key||"admin_token"===e.key)&&!e.newValue){n(!1),s.oR.info("Voc\xea foi desconectado.");let e=!!localStorage.getItem("admin_token");d.push(e?"/admin/login":"/login")}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[d]),i)?(0,o.jsx)("div",{className:"d-flex justify-content-center align-items-center min-vh-100",children:(0,o.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,o.jsx)("span",{className:"visually-hidden",children:"Carregando..."})})}):t?a:null}},82427:(e,a,t)=>{"use strict";t.d(a,{A:()=>l});let o=t(91040).A.create({baseURL:"https://backend.ib3capital.app.br/api"});o.interceptors.request.use(e=>{{let a=localStorage.getItem("admin_token"),t=localStorage.getItem("token"),o=a||t;o&&(e.headers.Authorization="Bearer ".concat(o),a?e.baseURL="https://backend.ib3capital.app.br/api/admin":e.baseURL="https://backend.ib3capital.app.br/api/investor")}return e});let l=o}},e=>{var a=a=>e(e.s=a);e.O(0,[4938,6701,1121,1040,2422,636,6593,8792],()=>a(36963)),_N_E=e.O()}]);
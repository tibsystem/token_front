let currentSvgWeight="sa-thin",isNoFill=!1,allIcons=[],searchHistory=new Set,searchTimeout=null,currentToast=null,iconMappings={},currentSearchTerm="",currentIconSet="sa",isLoadingIconSet=!1,selectedIcon=null,editingLayerIndex=null,db;const styleSheets={sa:null,svg:null,base:null,fal:"./css/fa-light.css",fas:"./css/fa-solid.css",far:"./css/fa-regular.css",fab:"./css/fa-brands.css",fad:"./css/duotone.css",material:"./css/material-icons.css"};function updateStylesheet(e){var t,a="dynamic-style-"+e,s=styleSheets[e],n=document.getElementById(a);!n&&s?((t=document.createElement("link")).id=a,t.rel="stylesheet",t.href=s,t.onload=function(){console.log(e+" stylesheet loaded")},t.onerror=function(){console.error("Failed to load "+e+" stylesheet")},document.head.appendChild(t)):n?console.log(e+" stylesheet is already loaded"):console.warn("No stylesheet defined for "+e)}function findSemanticMatches(t){if(t=t.toLowerCase().replace(/\s+/g,"-"),iconMappings[t])return iconMappings[t];var e=Object.keys(iconMappings).filter(e=>{e=e.toLowerCase().replace(/\s+/g,"-").replace(/^-/,"");return e.includes(t)||t.includes(e)});if(0<e.length)return e.flatMap(e=>iconMappings[e]);for(const s in iconMappings){var a=Object.keys(iconMappings[s]).filter(e=>{e=e.toLowerCase().replace(/\s+/g,"-").replace(/^-/,"");return e.includes(t)||t.includes(e)});if(0<a.length)return a.flatMap(e=>iconMappings[s][e])}return null}function findSuggestions(a){var e;return!a||a.length<2?[]:(e=findSemanticMatches(a=a.replace(/\s+/g,"-").replace(/^-/,"")))?[...new Set(e)].filter(e=>allIcons.includes("-"+e)||allIcons.includes(e)).map(e=>e.replace(/^-/,"")):allIcons.map(e=>{e=e.startsWith("-")?e.substring(1):e;return{name:e,distance:levenshteinDistance(a.toLowerCase(),e.toLowerCase())}}).filter(e=>{var t=Math.min(Math.floor(.4*a.length),3);return 0<e.distance&&e.distance<=t}).sort((e,t)=>e.distance-t.distance).slice(0,3).map(e=>e.name)}function levenshteinDistance(a,s){if(0===a.length)return s.length;if(0===s.length)return a.length;var n=Array(s.length+1).fill(null).map(()=>Array(a.length+1).fill(null));for(let e=0;e<=s.length;e++)n[e][0]=e;for(let e=0;e<=a.length;e++)n[0][e]=e;for(let t=1;t<=s.length;t++)for(let e=1;e<=a.length;e++)n[t][e]=s.charAt(t-1)===a.charAt(e-1)?n[t-1][e-1]:Math.min(n[t-1][e-1]+1,n[t][e-1]+1,n[t-1][e]+1);return n[s.length][a.length]}function initializeFilter(){document.getElementById("searchIcons").addEventListener("input",function(){currentSearchTerm=this.value.trim().replace(/^-/,""),filterIcons()})}function filterIcons(){const s=currentSearchTerm.toLowerCase().split(/\s+/).filter(e=>0<e.length).map(e=>e.replace(/^-/,""));document.querySelectorAll("#iconList li").forEach(e=>{const t=e.textContent.toLowerCase().replace(/^-/,"");var a=s.every(e=>t.includes(e));e.classList.toggle("js-filter-hide",!a)}),updateVisibleCount(),searchTimeout&&clearTimeout(searchTimeout),searchTimeout=setTimeout(()=>updateSearchHistory(currentSearchTerm),1e3);var e=document.querySelectorAll("#iconList li:not(.js-filter-hide)").length,t=document.getElementById("suggestions");2<=currentSearchTerm.length&&e<10?(e=findSuggestions(currentSearchTerm),t.innerHTML=0<e.length?'<span class="suggest-title">Did you mean?</span> '+e.map(e=>`<span class="suggestion px-1" onclick="applySearch('${e}')">${e}</span>`).join(" "):""):t.innerHTML=""}async function loadIconSet(e="sa"){if(isLoadingIconSet)console.log("Already loading an icon set, please wait...");else{isLoadingIconSet=!0;try{var t=document.getElementById("iconList"),a=(t.innerHTML='<div class="d-flex justify-content-center w-100 py-5"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>',document.getElementById("searchIcons")),s=(a&&(a.value="",currentSearchTerm=""),document.getElementById("suggestions").innerHTML="",{sa:{icons:"json/sa-icons.json",mappings:"json/sa-mappings.json",prefix:"sa"},base:{icons:"json/sa-base.json",mappings:"json/sa-mappings.json",prefix:"sa"},svg:{icons:"json/sa-svg-icons.json",mappings:"json/sa-svg-mappings.json",prefix:"svg"},fal:{icons:"json/fa-icons.json",mappings:"json/fa-mappings.json",prefix:"fal"},fas:{icons:"json/fa-icons.json",mappings:"json/fa-mappings.json",prefix:"fas"},far:{icons:"json/fa-icons.json",mappings:"json/fa-mappings.json",prefix:"far"},fab:{icons:"json/fa-brands.json",mappings:"json/fa-mappings.json",prefix:"fab"},fad:{icons:"json/fa-duotone.json",mappings:"json/fa-mappings.json",prefix:"fad"},material:{icons:"json/material-icons.json",mappings:"json/material-mappings.json",prefix:"material"}}),n=s[e]||s.sa;try{var[o,i]=await Promise.all([fetch(n.icons),fetch(n.mappings)]);if(!o.ok||!i.ok)throw new Error("Failed to load resources");allIcons=(await o.json()).map(e=>e.replace(/^-/,"")),iconMappings=await i.json(),updateStylesheet(currentIconSet=e),generateIconList(allIcons,n.prefix),document.getElementById("searchIcons").hasAttribute("data-initialized")||(initializeFilter(),document.getElementById("searchIcons").setAttribute("data-initialized","true")),console.log("Successfully loaded icon set: "+e)}catch(e){console.error("Error loading icon set:",e),t.innerHTML=`<div class="alert alert-danger m-3">Failed to load icon set: ${e.message}</div>`}}finally{isLoadingIconSet=!1}currentSearchTerm&&filterIcons(),updateVisibleCount()}}function generateIconList(e,a){document.getElementById("iconList").innerHTML=e.map(e=>{var e=e.replace(/^-/,""),t=getIconClass(a,e);return`
            <li class="d-flex justify-content-center align-items-center" style="width: 85px;" data-icon-name="${e}">
                <a href="#" class="js-showcase-icon rounded color-fusion-300 p-0 m-0 d-flex flex-column w-100 shadow-hover-2 ${"svg"===a?"has-svg":""}">
                    <div class="icon-preview rounded-top w-100 position-relative">
                        <div class="icon-container rounded-top d-flex align-items-center justify-content-center w-100 pt-2 pb-2 pe-2 ps-2 position-absolute">
                            ${t}
                        </div>
                    </div>
                    <div class="rounded-bottom p-1 w-100 d-flex justify-content-center align-items-center text-center mt-auto">
                        <span class="nav-link-text small text-muted text-truncate">${e}</span>
                    </div>
                </a>
            </li>
        `}).join(""),updateVisibleCount(),addIconClickHandlers()}function updateSearchHistory(e){e&&2<=e.length&&(searchHistory.add(e.replace(/^-/,"")),5<searchHistory.size&&searchHistory.delete([...searchHistory][0]),renderSearchHistory())}function renderSearchHistory(){document.getElementById("searchHistory").innerHTML=[...searchHistory].map(e=>`<span class="badge bg-secondary me-1" onclick="applySearch('${e}')">
            <span class="text-truncate-xs overflow-hidden">${e}</span>
            <i class="sa sa-close ms-1" onclick="event.stopPropagation(); removeFromHistory('${e}')"></i>
        </span>`).join("")}function removeFromHistory(e){searchHistory.delete(e),renderSearchHistory()}function applySearch(e){document.getElementById("searchIcons").value=e.replace(/^-/,""),currentSearchTerm=e.replace(/^-/,""),filterIcons()}function updateVisibleCount(){var e=document.querySelectorAll("#iconList li:not(.js-filter-hide)").length,t=allIcons.length;document.querySelector(".results-count").textContent=`Showing ${e} of ${t} icons`}const getIconClass=(e,t)=>{var a=t.replace(/^-/,"");switch(e){case"svg":return`<svg class="sa-icon ${currentSvgWeight}${isNoFill?" sa-nofill":""}"><use href="img/sprite.svg#${a}"></use></svg>`;case"fal":return`<i class="fal fa-${a}"></i>`;case"fas":return`<i class="fas fa-${a}"></i>`;case"far":return`<i class="far fa-${a}"></i>`;case"fad":return`<i class="fad fa-${a}"></i>`;case"fab":return`<i class="fab fa-${a}"></i>`;case"material":return`<i class="material-icons">${a}</i>`;case"sa":return`<i class="sa sa-${a}"></i>`;case"base":return`<i class="sa base-${a}"></i>`;default:return`<i class="${e} ${e}-${a}"></i>`}};function addIconClickHandlers(){const a=document.querySelector("#example-modal-backdrop-transparent .modal-footer .btn-primary");a&&(a.disabled=!0,a.classList.add("disabled")),document.querySelectorAll(".js-showcase-icon").forEach(e=>{var t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)}),document.querySelectorAll(".js-showcase-icon").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),document.querySelectorAll(".js-showcase-icon").forEach(e=>{e.classList.remove("selected-icon")}),this.classList.add("selected-icon");var e=this.querySelector("svg")||this.querySelector("i"),t=this.querySelector(".icon-container");e&&t&&(selectedIcon=t.innerHTML.trim(),console.log("Icon selected:",selectedIcon),a)&&(a.disabled=!1,a.classList.remove("disabled"))})})}function copyToClipboard(e){let t=e;var a,s;e.includes("sprite.svg#")&&(a=currentSvgWeight,s=isNoFill?" sa-nofill":"",t=`<svg class="sa-icon ${a}${s}"><use href="${e.split('href="')[1].split('"')[0]}"></use></svg>`),navigator.clipboard.writeText(t).then(()=>console.log("Icon class/markup copied:",t)).catch(e=>console.error("Failed to copy:",e))}function escapeHTML(e){return e.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"').replace(/'/g,"'")}function showToast(e,t="primary"){currentToast&&currentToast.hide();let a=document.querySelector(".toast-container");a||((a=document.createElement("div")).className="toast-container position-fixed top-0 end-0 p-3",document.body.appendChild(a));var s="toast-"+Date.now();const n=document.createElement("div");n.className=`toast hide align-items-center border-0 py-2 px-3 bg-${t} text-white`,n.id=s,n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.style.setProperty("--bs-toast-max-width","auto"),n.innerHTML=`
        <div class="d-flex">
            <div class="toast-body d-flex align-items-center justify-content-center">
                ${e}
            </div>
            <button type="button" class="btn btn-system ms-auto" data-bs-dismiss="toast" aria-label="Close">
                <svg class="sa-icon sa-icon-light">
                    <use href="img/sprite.svg#x"></use>
                </svg>
            </button>
        </div>
    `,a.appendChild(n),currentToast=new bootstrap.Toast(n,{autohide:!0,delay:3e3}),n.addEventListener("hidden.bs.toast",function(){currentToast=null,n.remove()}),currentToast.show()}function updateSvgClasses(){document.querySelectorAll("#iconList li").forEach(e=>{var t,a,e=e.querySelector("svg");e&&(t=currentSvgWeight,a=isNoFill?" sa-nofill":"",e.setAttribute("class","sa-icon "+t+a))})}function adjustZoom(e){var t,a=document.getElementById("stackgenerator-container"),s=a.className.match(/icon-zoom-(\d+)/),s=s?parseInt(s[1],10):0;if(0<s&&(a.className=a.className.replace(/icon-zoom-\d+/,"")),"in"===e)t=s<15?s+1:15;else{if("out"!==e)return;t=1<s?s-1:0}0<t&&(a.className+=" icon-zoom-"+t)}document.getElementById("zoomInBtn").onclick=function(){adjustZoom("in")},document.getElementById("zoomOutBtn").onclick=function(){adjustZoom("out")},document.addEventListener("DOMContentLoaded",function(){const p=document.getElementById("stack-control"),m=document.getElementById("stackgenerator-container");if(p&&m){var e,t=p.querySelector(".panel-hdr > h2");if(t){t.style.cursor="move",p.style.position="absolute",p.style.zIndex="50";let l=!1,c,r,d,u;if(updateSaveButtonState(),e=m.getBoundingClientRect(),a=p.getBoundingClientRect(),e=e.width-a.width-16,p.style.top="16px",p.style.left=e+"px",t.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),l=!0,c=e.clientX,r=e.clientY,e=p.getBoundingClientRect(),d=e.left,u=e.top,p.classList.add("is-dragging"),(e=document.createElement("div")).id="drag-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.zIndex="999",e.style.cursor="move",document.body.appendChild(e))}),document.addEventListener("mousemove",function(e){var t,a,s,n,o,i;l&&(i=e.clientX-c,e=e.clientY-r,t=m.getBoundingClientRect(),s=p.getBoundingClientRect(),i=d+i,e=u+e,a=t.right-s.width-16,s=t.bottom-s.height-16,n=t.left+16,o=t.top+16,i=Math.max(n,Math.min(a,i)),e=Math.max(o,Math.min(s,e)),p.style.left=i-t.left+"px",p.style.top=e-t.top+"px")}),document.addEventListener("mouseup",function(){var e,t,a;l&&(l=!1,p.classList.remove("is-dragging"),(a=document.getElementById("drag-overlay"))&&a.remove(),a=p.getBoundingClientRect(),e=m.getBoundingClientRect(),t=a.left-e.left,a=a.top-e.top,t=20*Math.round(t/20),a=20*Math.round(a/20),p.style.transition="all 0.2s ease-out",p.style.left=t+"px",p.style.top=a+"px",setTimeout(()=>{p.style.transition=""},200))}),window.addEventListener("resize",function(){requestAnimationFrame(function(){s(!0)})}),"undefined"!=typeof ResizeObserver)new ResizeObserver(function(){s(!0)}).observe(m);else{let e=m.clientWidth,t=m.clientHeight;setInterval(function(){e===m.clientWidth&&t===m.clientHeight||(e=m.clientWidth,t=m.clientHeight,s(!0))},250)}var a=document.createElement("style");function s(e=!1){var t=m.getBoundingClientRect(),a=p.getBoundingClientRect(),s=parseInt(p.style.left)||0,n=parseInt(p.style.top)||0,o=t.width-a.width-16,t=t.height-a.height-16,a=Math.max(16,Math.min(o,s)),o=Math.max(16,Math.min(t,n));e&&(p.style.transition="all 0.3s ease-out",setTimeout(()=>{p.style.transition=""},300)),p.style.left=a+"px",p.style.top=o+"px"}a.textContent=`
        #stack-control.is-dragging {
            opacity: 0.8;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        #stack-control .panel-hdr:hover {
            background-color: rgba(0,0,0,0.05);
        }
    `,document.head.appendChild(a)}}}),document.addEventListener("DOMContentLoaded",function(){var e=document.createElement("style");e.textContent=`
        .js-showcase-icon.selected-icon {
            border: 2px solid #2196F3;
            box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.3);
            transform: scale(1.05);
        }
        .layer-actions {
            display: flex;
            gap: 4px;
        }
        .stack-icon-preview {
            min-width: 50px;
            min-height: 50px;
        }
        
        /* Drag and drop styles */
        .sortable-ghost {
            opacity: 0.4;
            background-color: #f8f9fa;
        }
        .sortable-chosen {
            background-color: #f0f0f0;
        }
        .sortable-drag {
            opacity: 0.8;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        .drag-handle {
            cursor: move;
        }
        .drag-handle:active {
            cursor: grabbing;
        }
        
        /* Fine-tuning controls styles */
        .color-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            position: relative;
        }
        .color-btn.active::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            text-shadow: 0 0 2px rgba(0,0,0,0.5);
        }
        .color-btn[data-color="light"].active::after {
            color: #333;
        }
        
        
        /* Prevent collapse when clicking inside controls */
        .collapse.show {
            pointer-events: auto;
        }
        
        .collapse.show .mt-2.mb-2 {
            pointer-events: auto;
        }
        
        /* Make sure the tune button still works */
        .tune-layer {
            z-index: 2;
        }
        
        /* Prevent text selection when clicking controls */
        .control-panel-content {
            user-select: text;
            pointer-events: auto !important;
        }
        
        /* Ensure labels don't collapse panels */
        .form-label, .form-check-label {
            pointer-events: auto;
        }
        
        /* Ensure buttons in control panel don't collapse */
        .control-panel-content button,
        .control-panel-content input,
        .control-panel-content label {
            pointer-events: auto;
        }
        
        /* Additional fixes for collapse issue */
        .layer-control-panel {
            position: relative;
            z-index: 10;
        }
        
        .layer-control-panel .form-range,
        .layer-control-panel .btn-group,
        .layer-control-panel .form-check,
        .layer-control-panel .d-flex {
            pointer-events: auto !important;
            position: relative;
            z-index: 11;
        }
    `,document.head.appendChild(e);{const l=document.getElementById("example-modal-backdrop-transparent"),c=l.querySelector(".modal-footer .btn-primary"),r=document.getElementById("my-icon"),f=document.getElementById("stack-control").querySelector(".panel-content");l.addEventListener("hidden.bs.modal",function(){selectedIcon=null,document.querySelectorAll("#iconList li a.js-showcase-icon").forEach(e=>{e.classList.remove("selected-icon")}),c&&(c.disabled=!0,c.classList.add("disabled")),console.log("Modal closed, reset selection state")}),l.addEventListener("shown.bs.modal",function(){console.log("Modal opened, reattaching icon click handlers"),setTimeout(addIconClickHandlers,100)});let e=null;function t(){e&&e.destroy(),e=new Sortable(f,{animation:150,handle:".drag-handle",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",onEnd:function(e){{const t=f.querySelectorAll(".stack-layers"),a=[],l={},s=r.querySelectorAll(".icon-layers"),c=(s.forEach((e,t)=>{e=e.querySelector("svg, i");let a="0";if(e)for(const n of e.classList)if(n.startsWith("rotate-")){a=n.replace("rotate-","");break}let s="10";if(e)for(const o of e.classList)if(o.startsWith("alpha-")){s=o.replace("alpha-","");break}l[t]={rotation:a,opacity:s}}),{}),n=(t.forEach((e,t)=>{e=parseInt(e.dataset.layerIndex);0<=e&&e<s.length&&(a.push(s[e]),c[e]=t)}),r.innerHTML="",a.forEach(e=>{r.appendChild(e)}),i(),f.querySelectorAll(".stack-layers"));n.forEach(e=>{var t,a,s,n,o=parseInt(e.dataset.layerIndex);let i=null;for([t,a]of Object.entries(c))if(parseInt(a)===o){i=parseInt(t);break}null!==i&&l[i]&&(s=l[i],(n=e.querySelector(".rotation-slider"))&&(n.value=s.rotation,n=n.parentElement.querySelector(".rotation-value"))&&(n.textContent=s.rotation+"°"),n=e.querySelector(".opacity-slider"))&&(n.value=s.opacity,e=n.parentElement.querySelector(".opacity-value"))&&(e.textContent=s.opacity+"0%")})}}})}function i(){f.innerHTML="",r.querySelectorAll(".icon-layers").forEach((e,t)=>{var a=e.innerHTML.trim(),s=(e.className,document.createElement("div"));s.className="stack-layers d-flex flex-column",s.dataset.layerIndex=t;let n="Unknown Icon";a.includes('class="')&&(i=a.match(/class="([^"]+)"/))&&i[1]&&(a.includes("<svg")&&a.includes('href="')?(m=a.match(/href="[^#]+#([^"]+)"/))&&m[1]?n=m[1]:(m=i[1].split(" ").filter(e=>!["sa-icon","sa","stack-1x","stack-2x","stack-3x","fal","far","fas","fad","fab","text-primary","text-secondary","text-success","text-danger","text-warning","text-info","text-dark","text-light","sa-thin","sa-regular","sa-medium","sa-bold","sa-nofill","alpha-1","alpha-2","alpha-3","alpha-4","alpha-5","alpha-6","alpha-7","alpha-8","alpha-9","alpha-10"].includes(e)&&!e.startsWith("rotate-"))).some(e=>e.startsWith("sa-"))?n=m.find(e=>e.startsWith("sa-")):m.some(e=>e.startsWith("base-"))?n=m.find(e=>e.startsWith("base-")):0<m.length&&(n=m.join(" ")):(m=i[1].split(" ").filter(e=>!["sa-icon","sa","stack-1x","stack-2x","stack-3x","fal","far","fas","fad","fab","text-primary","text-secondary","text-success","text-danger","text-warning","text-info","text-dark","text-light","sa-thin","sa-regular","sa-medium","sa-bold","sa-nofill","alpha-1","alpha-2","alpha-3","alpha-4","alpha-5","alpha-6","alpha-7","alpha-8","alpha-9","alpha-10"].includes(e)&&!e.startsWith("rotate-"))).some(e=>e.startsWith("sa-"))?n=m.find(e=>e.startsWith("sa-")):m.some(e=>e.startsWith("base-"))?n=m.find(e=>e.startsWith("base-")):m.some(e=>e.startsWith("fa-"))?n=m.find(e=>e.startsWith("fa-")):0<m.length&&(n=m.join(" ")));var o=a.includes("<svg"),i=e.querySelector("svg, i");let l="2x",c=(i&&(i.classList.contains("stack-1x")?l="1x":i.classList.contains("stack-2x")?l="2x":i.classList.contains("stack-3x")&&(l="3x")),"0");if(i)for(const h of i.classList)if(h.startsWith("rotate-")){c=h.replace("rotate-","");break}let r="10";if(i)for(const g of i.classList)if(g.startsWith("alpha-")){r=g.replace("alpha-","");break}let d="";for(const y of["primary","secondary","success","danger","warning","info","dark","light"]){if(o&&e.querySelector("svg.sa-icon-"+y)){d=y;break}if(!o&&e.querySelector("i.text-"+y)){d=y;break}}let u="",p=!1;o?(m=e.querySelector("svg"))&&(m.classList.contains("sa-thin")?u="sa-thin":m.classList.contains("sa-regular")?u="sa-regular":m.classList.contains("sa-medium")?u="sa-medium":m.classList.contains("sa-bold")&&(u="sa-bold"),p=m.classList.contains("sa-nofill")):(u="",p=!1);var i=`
                    <div class="d-flex flex-row border-bottom position-relative">
                        <div class="stack-icon-preview flex-shrink-0 d-flex align-items-center justify-content-center">
                            ${a}
                        </div>
                        <div class="icon-settings d-flex flex-column flex-grow-1 border-start px-2 py-2 pe-4">
                            <div class="d-flex justify-content-between align-items-center flex-grow-1">
                                <div class="fs-sm">
                                    <span class="text-primary fw-bold">${n}</span>
                                    <span class="badge badge-icon">
                                        Layer ${t+1}
                                    </span>
                                </div>
                                <div class="layer-actions d-flex gap-1">
                                    
                                    <button type="button" class="btn btn-icon btn-outline-secondary edit-layer p-1 w-auto h-auto border-0" data-layer="${t}">
                                        <i class="sa sa-reload"></i>
                                    </button>
                                    <button type="button" class="btn btn-icon btn-outline-secondary tune-layer p-1 w-auto h-auto border-0" data-layer="${t}" data-bs-toggle="collapse" data-bs-target="#layer-controls-${t}" aria-expanded="false">
                                        <i class="sa sa-settings"></i>
                                    </button>
                                    <button type="button" class="btn btn-icon btn-outline-danger delete-layer p-1 w-auto h-auto border-0" data-layer="${t}">
                                        <i class="sa sa-close"></i>
                                    </button>
                                    <div class="drag-handle btn btn-icon btn-default-outline">
                                        <svg class="sa-icon sa-thin">
                                            <use href="img/sprite.svg#more-vertical"></use>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `,m=`
                    <div class="layer-control-panel collapse" id="layer-controls-${t}" data-layer="${t}">
                        <div class="control-panel-content shadow-inset-2 px-3 pt-1 pb-3" onclick="event.stopPropagation();">
                            <!-- Size controls -->
                            <div class="mb-2">
                                <label class="form-label mb-1 fs-sm">Size</label>
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="size-${t}" id="size-1x-${t}" value="1x" ${"1x"===l?"checked":""}>
                                    <label class="btn btn-outline-secondary btn-xs" for="size-1x-${t}">Small</label>
                                    
                                    <input type="radio" class="btn-check" name="size-${t}" id="size-2x-${t}" value="2x" ${"2x"===l?"checked":""}>
                                    <label class="btn btn-outline-secondary btn-xs" for="size-2x-${t}">Medium</label>
                                    
                                    <input type="radio" class="btn-check" name="size-${t}" id="size-3x-${t}" value="3x" ${"3x"===l?"checked":""}>
                                    <label class="btn btn-outline-secondary btn-xs" for="size-3x-${t}">Large</label>
                                </div>
                            </div>
                            
                            <!-- Rotation controls (slider) -->
                            <div class="mb-2">
                                <label class="form-label mb-1 fs-sm">Rotation: <span class="rotation-value">${c}°</span></label>
                                <input type="range" class="form-range rotation-slider" min="0" max="360" step="45" value="${c}" data-layer="${t}">
                            </div>
                            
                            <!-- Opacity slider -->
                            <div class="mb-2">
                                <label class="form-label mb-1 fs-sm">Opacity: <span class="opacity-value">${r}0%</span></label>
                                <input type="range" class="form-range opacity-slider" min="1" max="10" step="1" value="${r}" data-layer="${t}">
                            </div>
                            
                            <!-- SVG specific controls -->
                            ${o?`
                            <div class="mb-2">
                                <label class="form-label mb-1 fs-sm">SVG Weight</label>
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="weight-${t}" id="weight-thin-${t}" value="sa-thin" ${"sa-thin"===u?"checked":""}>
                                    <label class="btn btn-outline-secondary btn-xs" for="weight-thin-${t}">Thin</label>
                                    
                                    <input type="radio" class="btn-check" name="weight-${t}" id="weight-regular-${t}" value="sa-regular" ${"sa-regular"===u?"checked":""}>
                                    <label class="btn btn-outline-secondary btn-xs" for="weight-regular-${t}">Normal</label>
                                    
                                    <input type="radio" class="btn-check" name="weight-${t}" id="weight-medium-${t}" value="sa-medium" ${"sa-medium"===u?"checked":""}>
                                    <label class="btn btn-outline-secondary btn-xs" for="weight-medium-${t}">Medium</label>
                                    
                                    <input type="radio" class="btn-check" name="weight-${t}" id="weight-bold-${t}" value="sa-bold" ${"sa-bold"===u?"checked":""}>
                                    <label class="btn btn-outline-secondary btn-xs" for="weight-bold-${t}">Bold</label>
                                </div>
                            </div>
                            
                            <div class="mb-2 form-check">
                                <input type="checkbox" class="form-check-input svg-nofill-check" id="nofill-${t}" ${p?"checked":""} data-layer="${t}">
                                <label class="form-check-label" for="nofill-${t}">No Fill</label>
                            </div>
                            `:""}
                            
                            <!-- Color controls -->
                            <div>
                                <label class="form-label mb-1 fs-sm">Color</label>
                                <div class="d-flex flex-wrap gap-1">
                                    <button type="button" class="btn btn-icon btn-outline-default color-btn ${d?"":"active"}" data-color="" data-layer="${t}">
                                        <i class="sa sa-ban"></i>
                                    </button>
                                    <button type="button" class="btn btn-icon btn-primary color-btn ${"primary"===d?"active":""}" data-color="primary" data-layer="${t}"></button>
                                    <button type="button" class="btn btn-icon btn-secondary color-btn ${"secondary"===d?"active":""}" data-color="secondary" data-layer="${t}"></button>
                                    <button type="button" class="btn btn-icon btn-success color-btn ${"success"===d?"active":""}" data-color="success" data-layer="${t}"></button>
                                    <button type="button" class="btn btn-icon btn-danger color-btn ${"danger"===d?"active":""}" data-color="danger" data-layer="${t}"></button>
                                    <button type="button" class="btn btn-icon btn-warning color-btn ${"warning"===d?"active":""}" data-color="warning" data-layer="${t}"></button>
                                    <button type="button" class="btn btn-icon btn-info color-btn ${"info"===d?"active":""}" data-color="info" data-layer="${t}"></button>
                                    <button type="button" class="btn btn-icon btn-dark color-btn ${"dark"===d?"active":""}" data-color="dark" data-layer="${t}"></button>
                                    <button type="button" class="btn btn-icon btn-default color-btn ${"light"===d?"active":""}" data-color="light" data-layer="${t}"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;s.innerHTML=i+m,f.appendChild(s)}),f.querySelectorAll(".edit-layer").forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation();var t,e=parseInt(this.dataset.layer);e=e,t=r.querySelectorAll(".icon-layers"),0<=e&&e<t.length&&(editingLayerIndex=e,selectedIcon=null,document.querySelectorAll("#iconList li a.js-showcase-icon").forEach(e=>{e.classList.remove("selected-icon")}),c&&(c.disabled=!0,c.classList.add("disabled")),(t=l.querySelector(".modal-title"))&&(t.textContent="Editing Icon for Layer "+(e+1)),new bootstrap.Modal(l).show())})}),f.querySelectorAll(".delete-layer").forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation();var t,e=parseInt(this.dataset.layer);e=e,t=r.querySelectorAll(".icon-layers"),0<=e&&e<t.length&&confirm("Are you sure you want to delete this icon layer?")&&(t[e].remove(),i(),updateSaveButtonState())})}),f.querySelectorAll(".tune-layer").forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation();const t=this.getAttribute("data-bs-target");document.querySelector(t).classList.contains("show")||document.querySelectorAll(".layer-control-panel.show").forEach(e=>{e.id!==t.substring(1)&&(e=bootstrap.Collapse.getInstance(e))&&e.hide()})})}),f.querySelectorAll(".control-panel-content").forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation()})}),f.querySelectorAll(".layer-control-panel input, .layer-control-panel label, .layer-control-panel button").forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation()})}),t(),f.querySelectorAll('input[type="radio"][name^="size-"]').forEach(e=>{e.addEventListener("change",function(e){e.stopPropagation();var t,e=parseInt(this.id.split("-")[2]),a=this.value;e=e,a=a,t=r.querySelectorAll(".icon-layers"),0<=e&&e<t.length&&(t=t[e].querySelector("svg, i"))&&(t.classList.remove("stack-1x","stack-2x","stack-3x"),t.classList.add("stack-"+a))})}),document.querySelectorAll(".rotation-slider").forEach(e=>{e.addEventListener("input",function(e){e.stopPropagation();var e=parseInt(this.dataset.layer),t=this.value,a=this.parentElement.querySelector(".rotation-value"),a=(a&&(a.textContent=t+"°"),"360"===t?"0":t),t=e,e=a,a=r.querySelectorAll(".icon-layers");if(0<=t&&t<a.length){var s=a[t].querySelector("svg, i");if(s){for(let e=0;e<=360;e+=45)s.classList.remove("rotate-"+e);"0"!==e&&"360"!==e&&s.classList.add("rotate-"+e);a=f.querySelector(`.stack-layers[data-layer-index="${t}"] .stack-icon-preview`);if(a){var n=a.querySelector("svg, i");if(n){for(let e=0;e<=360;e+=45)n.classList.remove("rotate-"+e);"0"!==e&&"360"!==e&&n.classList.add("rotate-"+e)}}}}})}),f.querySelectorAll(".opacity-slider").forEach(e=>{e.addEventListener("input",function(e){e.stopPropagation();var e=parseInt(this.dataset.layer),t=this.value,a=this.parentElement.querySelector(".opacity-value"),a=(a&&(a.textContent=t+"0%"),e),e=t,t=r.querySelectorAll(".icon-layers");if(0<=a&&a<t.length){var s=t[a].querySelector("svg, i");if(s){for(let e=1;e<=10;e++)s.classList.remove("alpha-"+e);"10"!==e&&s.classList.add("alpha-"+e);t=f.querySelector(`.stack-layers[data-layer-index="${a}"] .stack-icon-preview`);if(t){var n=t.querySelector("svg, i");if(n){for(let e=1;e<=10;e++)n.classList.remove("alpha-"+e);"10"!==e&&n.classList.add("alpha-"+e)}}}}})}),f.querySelectorAll('input[type="radio"][name^="weight-"]').forEach(e=>{e.addEventListener("change",function(e){e.stopPropagation();var t,e=parseInt(this.id.split("-")[2]),a=this.value;e=e,a=a,t=r.querySelectorAll(".icon-layers"),0<=e&&e<t.length&&(t=t[e].querySelector("svg"))&&(t.classList.remove("sa-thin","sa-regular","sa-medium","sa-bold"),a&&t.classList.add(a),t=f.querySelector(`.stack-layers[data-layer-index="${e}"] .stack-icon-preview`))&&(e=t.querySelector("svg"))&&(e.classList.remove("sa-thin","sa-regular","sa-medium","sa-bold"),a)&&e.classList.add(a)})}),f.querySelectorAll(".svg-nofill-check").forEach(e=>{e.addEventListener("change",function(e){e.stopPropagation();var t,e=parseInt(this.dataset.layer),a=this.checked;e=e,a=a,t=r.querySelectorAll(".icon-layers"),0<=e&&e<t.length&&(t=t[e].querySelector("svg"))&&(a?t.classList.add("sa-nofill"):t.classList.remove("sa-nofill"),t=f.querySelector(`.stack-layers[data-layer-index="${e}"] .stack-icon-preview`))&&(e=t.querySelector("svg"))&&(a?e.classList.add("sa-nofill"):e.classList.remove("sa-nofill"))})}),f.querySelectorAll(".color-btn").forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation();var e=parseInt(this.dataset.layer),t=this.dataset.color,a=(this.parentElement.querySelectorAll(".color-btn").forEach(e=>e.classList.remove("active")),this.classList.add("active"),r.querySelectorAll(".icon-layers"));if(0<=e&&e<a.length){a=a[e];if(a.innerHTML.includes("<svg")){const o=a.querySelector("svg");if(o){var s=["primary","secondary","success","danger","warning","info","dark","light"].map(e=>"sa-icon-"+e),n=(s.forEach(e=>{o.classList.remove(e)}),t&&o.classList.add("sa-icon-"+t),f.querySelector(`.stack-layers[data-layer-index="${e}"] .stack-icon-preview`));if(n){const i=n.querySelector("svg");i&&(s.forEach(e=>{i.classList.remove(e)}),t)&&i.classList.add("sa-icon-"+t)}}}else{const l=a.querySelector("i");if(l){n=["text-primary","text-secondary","text-success","text-danger","text-warning","text-info","text-dark","text-light"],s=(n.forEach(e=>{l.classList.remove(e)}),t&&l.classList.add("text-"+t),f.querySelector(`.stack-layers[data-layer-index="${e}"] .stack-icon-preview`));if(s){const c=s.querySelector("i");c&&(n.forEach(e=>{c.classList.remove(e)}),t)&&c.classList.add("text-"+t)}}}}})})}i(),c.addEventListener("click",function(){if(console.log("Select button clicked, selectedIcon:",selectedIcon),selectedIcon){var e=r.querySelectorAll(".icon-layers");if(null!==editingLayerIndex){if(0<=editingLayerIndex&&editingLayerIndex<e.length){var t=e[editingLayerIndex].querySelector("svg, i"),t={size:t?t.classList.contains("stack-1x")?"stack-1x":!t.classList.contains("stack-2x")&&t.classList.contains("stack-3x")?"stack-3x":"stack-2x":"stack-2x",rotation:t?t.classList.contains("rotate-45")?"rotate-45":t.classList.contains("rotate-90")?"rotate-90":t.classList.contains("rotate-135")?"rotate-135":t.classList.contains("rotate-180")?"rotate-180":t.classList.contains("rotate-225")?"rotate-225":t.classList.contains("rotate-270")?"rotate-270":t.classList.contains("rotate-315")?"rotate-315":"":"",opacity:t?t.classList.contains("alpha-1")?"alpha-1":t.classList.contains("alpha-2")?"alpha-2":t.classList.contains("alpha-3")?"alpha-3":t.classList.contains("alpha-4")?"alpha-4":t.classList.contains("alpha-5")?"alpha-5":t.classList.contains("alpha-6")?"alpha-6":t.classList.contains("alpha-7")?"alpha-7":t.classList.contains("alpha-8")?"alpha-8":t.classList.contains("alpha-9")?"alpha-9":"":"",color:t?t.classList.contains("text-primary")?"text-primary":t.classList.contains("text-secondary")?"text-secondary":t.classList.contains("text-success")?"text-success":t.classList.contains("text-danger")?"text-danger":t.classList.contains("text-warning")?"text-warning":t.classList.contains("text-info")?"text-info":t.classList.contains("text-dark")?"text-dark":t.classList.contains("text-light")?"text-light":"":"",svgWeight:t&&"svg"===t.tagName?t.classList.contains("sa-thin")?"sa-thin":t.classList.contains("sa-regular")?"sa-regular":t.classList.contains("sa-medium")?"sa-medium":t.classList.contains("sa-bold")?"sa-bold":"":"",svgColor:t&&"svg"===t.tagName?t.classList.contains("sa-icon-primary")?"sa-icon-primary":t.classList.contains("sa-icon-secondary")?"sa-icon-secondary":t.classList.contains("sa-icon-success")?"sa-icon-success":t.classList.contains("sa-icon-danger")?"sa-icon-danger":t.classList.contains("sa-icon-warning")?"sa-icon-warning":t.classList.contains("sa-icon-info")?"sa-icon-info":t.classList.contains("sa-icon-dark")?"sa-icon-dark":t.classList.contains("sa-icon-light")?"sa-icon-light":"":"",noFill:!(!t||"svg"!==t.tagName)&&t.classList.contains("sa-nofill")},a=document.createElement("div");a.innerHTML=selectedIcon;const n=a.querySelector("svg, i");if(n){if(n.classList.remove("stack-1x","stack-2x","stack-3x"),n.classList.remove("rotate-45","rotate-90","rotate-135","rotate-180","rotate-225","rotate-270","rotate-315"),n.classList.remove("alpha-1","alpha-2","alpha-3","alpha-4","alpha-5","alpha-6","alpha-7","alpha-8","alpha-9"),n.classList.remove("text-primary","text-secondary","text-success","text-danger","text-warning","text-info","text-dark","text-light"),n.classList.remove("sa-icon-primary","sa-icon-secondary","sa-icon-success","sa-icon-danger","sa-icon-warning","sa-icon-info","sa-icon-dark","sa-icon-light"),n.classList.remove("sa-thin","sa-regular","sa-medium","sa-bold","sa-nofill"),"svg"!==n.tagName.toLowerCase()){const o=/^(sa-(thin|regular|medium|bold|nofill))$/;Array.from(n.classList).forEach(e=>{o.test(e)&&n.classList.remove(e)})}n.classList.add(t.size),t.rotation&&n.classList.add(t.rotation),t.opacity&&n.classList.add(t.opacity),"svg"===n.tagName.toLowerCase()?(t.svgWeight&&n.classList.add(t.svgWeight),t.svgColor&&n.classList.add(t.svgColor),t.noFill&&n.classList.add("sa-nofill"),!t.svgColor&&t.color&&(s={"text-primary":"sa-icon-primary","text-secondary":"sa-icon-secondary","text-success":"sa-icon-success","text-danger":"sa-icon-danger","text-warning":"sa-icon-warning","text-info":"sa-icon-info","text-dark":"sa-icon-dark","text-light":"sa-icon-light"})[t.color]&&n.classList.add(s[t.color])):(t.color&&n.classList.add(t.color),!t.color&&t.svgColor&&(s={"sa-icon-primary":"text-primary","sa-icon-secondary":"text-secondary","sa-icon-success":"text-success","sa-icon-danger":"text-danger","sa-icon-warning":"text-warning","sa-icon-info":"text-info","sa-icon-dark":"text-dark","sa-icon-light":"text-light"})[t.svgColor]&&n.classList.add(s[t.svgColor]))}e[editingLayerIndex].innerHTML=a.innerHTML}editingLayerIndex=null}else{if(4<=e.length)return void showToast("Maximum of 4 icon layers allowed","danger");var s=document.createElement("div"),t=(s.className="icon-layers",document.createElement("div")),a=(t.innerHTML=selectedIcon,t.querySelector("svg, i"));a&&(a.classList.remove("stack-1x","stack-2x","stack-3x"),a.classList.add("stack-2x")),s.innerHTML=t.innerHTML,r.appendChild(s)}i(),updateSaveButtonState(),selectedIcon=null,document.querySelectorAll("#iconList li a.js-showcase-icon").forEach(e=>{e.classList.remove("selected-icon")}),c.disabled=!0,c.classList.add("disabled");e=l.querySelector(".modal-title");e&&(e.textContent="Select an Icon"),bootstrap.Modal.getInstance(l).hide()}else showToast("Please select an icon first","warning")}),document.getElementById("add-layer").addEventListener("click",function(e){if(4<=r.querySelectorAll(".icon-layers").length)return showToast("Maximum of 4 icon layers allowed","danger"),e.stopPropagation(),!1;editingLayerIndex=null,selectedIcon=null;e=l.querySelector(".modal-title");e&&(e.textContent="Select an Icon"),c&&(c.disabled=!0,c.classList.add("disabled"))}),document.getElementById("reset-layers").addEventListener("click",function(){confirm("Are you sure you want to reset all icon layers?")&&(r.innerHTML="",i(),updateSaveButtonState(),showToast("All icon layers have been reset","primary"))})}e=document.getElementById("copy-icon");e&&e.addEventListener("click",function(){var e=document.getElementById("my-icon");if(e){e=e.querySelectorAll(".icon-layers");if(e.length<2)showToast("Incomplete icon. A minimum of 2 layers is required.","warning");else{let t='<div class="stack-icon">';e.forEach(e=>{t+=e.outerHTML}),t+="</div>",navigator.clipboard.writeText(t).then(()=>showToast("Icon copied to clipboard!","success")).catch(()=>showToast("Failed to copy icon","danger"))}}else showToast("No icon found to copy","danger")})});const DB_NAME="IconStackDB",STORE_NAME="savedIcons",DB_VERSION=1;function initDB(){return new Promise((e,t)=>{const a=indexedDB.open(DB_NAME,DB_VERSION);a.onerror=()=>t(a.error),a.onsuccess=()=>{db=a.result,e(db)},a.onupgradeneeded=e=>{var e=e.target.result;e.objectStoreNames.contains(STORE_NAME)||((e=e.createObjectStore(STORE_NAME,{keyPath:"id",autoIncrement:!0})).createIndex("name","name",{unique:!0}),e.createIndex("createdAt","createdAt",{unique:!1}))}})}async function checkDuplicateIcon(a){const s=db.transaction([STORE_NAME],"readonly").objectStore(STORE_NAME).getAll();return new Promise((t,e)=>{s.onsuccess=()=>{var e=s.result.some(e=>e.html===a);t(e)},s.onerror=()=>e(s.error)})}async function checkDuplicateName(e){const a=db.transaction([STORE_NAME],"readonly").objectStore(STORE_NAME).index("name").get(e);return new Promise((e,t)=>{a.onsuccess=()=>{e(void 0!==a.result)},a.onerror=()=>t(a.error)})}async function saveIconToDB(e,t){const s=db.transaction([STORE_NAME],"readwrite").objectStore(STORE_NAME),n={name:e,html:t,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};return new Promise((e,t)=>{const a=s.add(n);a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)})}function createNamingModal(){return document.getElementById("iconNamingModal")||document.body.insertAdjacentHTML("beforeend",`
        <div class="modal fade" id="iconNamingModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Save Icon</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="iconName" class="form-label">Icon Name (no spaces, max 15 characters)</label>
                            <input type="text" class="form-control" id="iconName" maxlength="15" 
                                pattern="[A-Za-z0-9_\\-]+" placeholder="Enter a unique name for your icon">
                            <div class="invalid-feedback">Name must not contain spaces or special characters (except - and _), and must be unique.</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-success" id="confirmSave" disabled>Save</button>
                    </div>
                </div>
            </div>
        </div>
    `),new bootstrap.Modal(document.getElementById("iconNamingModal"))}async function handleIconSave(){var e=document.getElementById("my-icon");if(e)if(e.querySelectorAll(".icon-layers").length<2)showToast("Incomplete icon. A minimum of 2 layers is required.","warning");else{const a=e.innerHTML;if(await checkDuplicateIcon(a))showToast("This icon already exists in your saved icons","warning");else{const s=createNamingModal();e=document.getElementById("iconNamingModal");const n=e.querySelector("#iconName"),o=e.querySelector("#confirmSave"),i=e.querySelector(".invalid-feedback");function t(e){return e.replace(/\s+/g,"").replace(/[^\w\-]/g,"").substring(0,15)}n.value="",n.classList.remove("is-invalid"),i.style.display="none",o.disabled=!0,n.addEventListener("input",async function(){var e=t(this.value),e=(this.value!==e&&(this.value=e),e.trim());e?await checkDuplicateName(e)?(this.classList.add("is-invalid"),i.textContent="This name is already taken.",i.style.display="block",o.disabled=!0):this.checkValidity()?(this.classList.remove("is-invalid"),i.style.display="none",o.disabled=!1):(this.classList.add("is-invalid"),i.textContent="Name must not contain spaces or special characters (except - and _).",i.style.display="block",o.disabled=!0):(this.classList.add("is-invalid"),i.style.display="block",o.disabled=!0)}),o.addEventListener("click",async function(){var e=n.value.trim();if(e&&n.checkValidity())try{await saveIconToDB(t(e),a),showToast("Icon saved successfully!","success"),s.hide()}catch(e){console.error("Error saving icon:",e),showToast("Failed to save icon","danger")}}),s.show()}}else showToast("No icon found to save","danger")}async function getAllSavedIcons(){const a=db.transaction([STORE_NAME],"readonly").objectStore(STORE_NAME).getAll();return new Promise((e,t)=>{a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)})}async function getIconByName(e){const a=db.transaction([STORE_NAME],"readonly").objectStore(STORE_NAME).index("name").get(e);return new Promise((e,t)=>{a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)})}function updateSaveButtonState(){var e=document.getElementById("save-icon"),t=document.getElementById("copy-icon"),a=document.getElementById("my-icon");a?(a=a.querySelectorAll(".icon-layers").length<2,e&&(e.disabled=a),t&&(t.disabled=a)):(e&&(e.disabled=!0),t&&(t.disabled=!0))}document.addEventListener("DOMContentLoaded",async function(){try{await initDB(),console.log("IndexedDB initialized successfully"),updateSaveButtonState()}catch(e){console.error("Error initializing IndexedDB:",e)}}),document.getElementById("save-icon").addEventListener("click",handleIconSave);
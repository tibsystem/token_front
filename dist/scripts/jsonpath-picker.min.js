function isCollapsable(e){return e instanceof Object&&0<Object.keys(e).length}function isUrl(e){return/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#:.?+=&%@!\-/]))?/.test(e)}function json2html(t,n){let o="";if("string"==typeof t){var e=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");isUrl(e)?o+=`<a href="${e}" class="json-string">${e}</a>`:o+=`<span class="json-string">"${e}"</span>`}else if("number"==typeof t)o+=`<span class="json-literal">${t}</span>`;else if("boolean"==typeof t)o+=`<span class="json-literal">${t}</span>`;else if(null===t)o+='<span class="json-literal">null</span>';else if(t instanceof Array)if(0<t.length){o+='[<ol class="json-array">';for(let e=0;e<t.length;e+=1)o+=`<li data-key-type="array" data-key="${e}">`,isCollapsable(t[e])&&(o+='<a href class="json-toggle"></a>'),o+=json2html(t[e],n),e<t.length-1&&(o+=","),o+="</li>";o+="</ol>]"}else o+="[]";else if("object"==typeof t){let e=Object.keys(t).length;if(0<e){o+='{<ul class="json-dict">';for(const l in t){var i;t.hasOwnProperty(l)&&(o+=`<li data-key-type="object" data-key="${l}">`,i=n.outputWithQuotes?`<span class="json-string">"${l}"</span>`:l,isCollapsable(t[l])?o+=`<a href class="json-toggle">${i}</a>`:o+=i,o=(o+='<span class="pick-path" title="Pick path">&'+n.pickerIcon+";</span>")+": "+json2html(t[l],n),0<--e&&(o+=","),o+="</li>")}o+="</ul>}"}else o+="{}"}return o}function off(e,t,n,o){let i=o,l=n,s=t;"function"==typeof t&&(i=n,l=t,s=window),i=!!i,(s="string"==typeof s?document.querySelector(s):s)&&s.removeEventListener(e,l,i)}function siblings(t,n,o){var i=[];for(let e=0;e<t.parentNode.children.length;e+=1){var l=t.parentNode.children[e];l!==t&&"string"==typeof n&&l.matches(n)&&i.push(l)}if(o&&"function"==typeof o)for(let e=0;e<i.length;e+=1)o(i[e]);return i}function fireClick(e){let t;if(e.ownerDocument)t=e.ownerDocument;else{if(9!==e.nodeType)throw new Error("Invalid node passed to fireEvent: "+e.id);t=e}var n;e.dispatchEvent?((n=t.createEvent("MouseEvents")).initEvent("click",!0,!0),n.synthetic=!0,e.dispatchEvent(n,!0)):e.fireEvent&&((n=t.createEventObject()).synthetic=!0,e.fireEvent("onclick",n))}function isHidden(e){var t=e.offsetWidth,n=e.offsetHeight;return 0===t&&0===n||"none"===window.getComputedStyle(e).display}function getParents(t,n){var o=[];for(let e=t&&t.parentElement;e;e=e.parentElement)"string"==typeof n&&e.matches(n)&&o.push(e);return o}function HandlerEventToggle(e,t){e.classList.toggle("collapsed");var n=siblings(e,"ul.json-dict, ol.json-array",e=>{e.style.display=""===e.style.display||"block"===e.style.display?"none":"block"});for(let e=0;e<n.length;e+=1)if(isHidden(n[e])){var o=n[e].children;let t=0;for(let e=0;e<o.length;e+=1)"LI"===o[e].tagName&&(t+=1);var i=t+(1<t?" items":" item");n[e].insertAdjacentHTML("afterend",`<a href class="json-placeholder">${i}</a>`)}else siblings(n[e],".json-placeholder",e=>e.parentNode.removeChild(e));t.stopPropagation(),t.preventDefault()}function ToggleEventListener(e){let t=e.target;for(;t&&t!==this;)t.matches("a.json-toggle")&&(HandlerEventToggle.call(null,t,e),e.stopPropagation(),e.preventDefault()),t=t.parentNode}function SimulateClickHandler(e,t){siblings(e,"a.json-toggle",e=>fireClick(e)),t.stopPropagation(),t.preventDefault()}function SimulateClickEventListener(e){let t=e.target;for(;t&&t!==this;)t.matches("a.json-placeholder")&&SimulateClickHandler.call(null,t,e),t=t.parentNode}function PickPathHandler(e){if(0!==targetList.length){var o=getParents(e,"li").reverse();let n=[];for(let t=0;t<o.length;t+=1){let e=o[t].dataset["key"];var i,l,s=o[t].dataset["keyType"];"object"===s&&"number"!=typeof e&&options.processKeys&&void 0!==options.keyReplaceRegexPattern&&(i=new RegExp(options.keyReplaceRegexPattern,options.keyReplaceRegexFlags),l=void 0===options.keyReplacementText?"":options.keyReplacementText,e=e.replace(i,l)),n.push({key:e,keyType:s})}const a={none:"",single:"'",double:'"'}[options.pathQuotesType];var t=(n=n.map((e,t)=>{var n="brackets"===options.pathNotation,o=!/^\w+$/.test(e.key)||"number"==typeof e.key;return"array"===e.keyType||e.isKeyANumber?`[${e.key}]`:n||o?`[${a}${e.key}${a}]`:0<t?"."+e.key:e.key})).join("");for(let e=0;e<targetList.length;e+=1)void 0!==targetList[e].value&&(targetList[e].value=t)}}function PickEventListener(e){let t=e.target;for(;t&&t!==this;)t.matches(".pick-path")&&PickPathHandler.call(null,t),t=t.parentNode}function uuidv4(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t="",n=32;0<n;--n)t+=e[Math.floor(Math.random()*e.length)];return t}let targetList=[],options={};function jsonPathPicker(e,t,n,o){if(options=o||{},!(e instanceof Element))return 1;if(!n)return 3;if(n.length)targetList=n;else{if(!n.value)return 3;targetList=[n]}o=uuidv4();e.id=e.id?e.id+" "+o:o,e.setAttribute("data-jsonpath-uniq-id",o),options.pathQuotesType=void 0!==options.pathQuotesType?options.pathQuotesType:"single",options.pickerIcon=options.pickerIcon||"#x1f4cb";let i=json2html(t,options);if(isCollapsable(t)&&(i='<a href class="json-toggle"></a>'+i),e.innerHTML=i,off("click",e),e.addEventListener("click",ToggleEventListener),e.addEventListener("click",SimulateClickEventListener),options.WithoutPicker?(n=e.getAttribute("data-jsonpath-uniq-id"),document.querySelectorAll(`[id*='${n}'] .pick-path`).forEach(e=>e.parentNode.removeChild(e))):e.addEventListener("click",PickEventListener),!0===options.outputCollapsed){var l=document.querySelectorAll("a.json-toggle");for(let e=0;e<l.length;e+=1)fireClick(l[e])}}function clearJsonPathPicker(e){if(!(e instanceof Element))return 1;e.removeEventListener("click",PickEventListener),e.removeEventListener("click",ToggleEventListener),e.removeEventListener("click",SimulateClickEventListener)}module.exports={jsonPathPicker:jsonPathPicker,clearJsonPathPicker:clearJsonPathPicker};
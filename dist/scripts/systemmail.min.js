let emailList,selectAllCheckbox,refreshButton,deleteButton,spamButton,composeModal,sendButton,saveDraftButton,showMoreButton,attachmentsContainer;function initializeElements(){emailList=document.getElementById("js-emails"),selectAllCheckbox=document.getElementById("js-msg-select-all"),refreshButton=document.querySelector(".js-refresh").closest("button"),deleteButton=document.querySelector(".js-delete").closest("button"),spamButton=document.querySelector(".js-spam").closest("button"),composeModal=document.getElementById("default-example-modal-lg-center"),sendButton=composeModal?.querySelector(".btn-primary"),saveDraftButton=composeModal?.querySelector(".btn-secondary"),showMoreButton=document.querySelector("a.fs-xs.text-secondary"),attachmentsContainer=document.getElementById("message-attachments")}function setupEventListeners(){emailList.addEventListener("click",handleEmailInteractions),selectAllCheckbox?.addEventListener("change",handleSelectAll),refreshButton?.addEventListener("click",handleRefresh),deleteButton?.addEventListener("click",handleDelete),spamButton?.addEventListener("click",handleSpam),sendButton?.addEventListener("click",handleSendEmail),saveDraftButton?.addEventListener("click",handleSaveDraft),showMoreButton?.addEventListener("click",handleShowMore)}function handleEmailInteractions(e){var t=e.target.closest(".mail-starred");if(t){t=t.closest("li");const n=t.querySelector(".form-check-input").id.replace("msg-","");t.classList.toggle("starred");var t=JSON.parse(localStorage.getItem("emails")||"[]"),s=t.find(e=>e.id===n);s&&(s.starred=!s.starred,localStorage.setItem("emails",JSON.stringify(t))),void e.stopPropagation()}else e.target.closest(".js-email-content")&&(window.location.href="systemmail-read.html")}function handleSelectAll(t){emailList.querySelectorAll(".form-check-input").forEach(e=>{e.checked=t.target.checked})}function handleRefresh(){emailList.classList.add("refreshing"),refreshButton.querySelector("i").classList.add("fa-spin"),setTimeout(()=>{loadEmails(),emailList.classList.remove("refreshing"),refreshButton.querySelector("i").classList.remove("fa-spin")},1e3)}function handleDelete(){var e,t=emailList.querySelectorAll(".form-check-input:checked");0!==t.length&&(e=t.length,t.forEach(e=>{const t=e.closest("li");t.style.overflow="hidden",t.classList.add("deleting"),setTimeout(()=>{t.remove()},300)}),showToast(e+` message${1<e?"s":""} deleted`))}function handleSpam(){var e,t=emailList.querySelectorAll(".form-check-input:checked");0!==t.length&&(e=t.length,t.forEach(e=>{const t=e.closest("li");t.style.overflow="hidden",t.classList.add("deleting"),setTimeout(()=>{t.remove()},300)}),showToast(e+` message${1<e?"s":""} moved to spam`))}function handleSendEmail(e){e.preventDefault();var e=document.getElementById("message-to").value,t=document.querySelector('input[placeholder="Subject"]').value,s=document.getElementById("fake_textarea").innerHTML;e&&t&&s?(bootstrap.Modal.getInstance(composeModal).hide(),showToast("Email sent successfully!"),resetComposeForm(!0)):alert("Please fill in all required fields")}function handleSaveDraft(e){e.preventDefault(),bootstrap.Modal.getInstance(composeModal).hide(),showToast('<i class="fas fa-check me-2"></i> Draft saved',"success")}function showToast(e,t="success"){const s=document.createElement("div");s.className=`mail-toast bg-${t}-500`,s.innerHTML=e,document.body.appendChild(s),setTimeout(()=>s.classList.add("show"),100),setTimeout(()=>{s.classList.remove("show"),setTimeout(()=>s.remove(),300)},3e3)}function resetComposeForm(e=!1){document.getElementById("message-to").value="",document.getElementById("message-to-cc").value="",document.querySelector('input[placeholder="Subject"]').value="",attachmentsContainer&&(e?(attachmentsContainer.innerHTML="",(e=document.createElement("a")).href="#",e.className="fs-xs text-secondary",e.textContent="show 3 more",e.addEventListener("click",handleShowMore),attachmentsContainer.appendChild(e),attachmentsContainer.classList.add("if-empty-display-none")):(attachmentsContainer.querySelectorAll(".alert").forEach((e,t)=>{1<t?e.remove():e.classList.remove("hidden-attachment")}),showMoreButton&&(showMoreButton.style.display="none"))),document.getElementById("fake_textarea").innerHTML=`
    <p><br></p>
    <p><br></p>
    <p>Best regards,</p>
    <div class="d-flex d-column align-items-start mb-3 gap-2">
        <img src="img/avatar-admin.png" alt="SmartAdmin WebApp" class="me-3 mt-1 rounded-circle width-2">
        <div class="border-left pl-3">
            <span class="fw-500 fs-lg d-block l-h-n">Sunny A.</span>
            <span class="fw-400 fs-nano d-block l-h-n mb-1">Software Engineer</span>
        </div>
    </div>
    <div class="text-muted fs-nano">
        PRIVATE AND CONFIDENTIAL. This e-mail, its contents and attachments are private and confidential and is intended for the recipient only. Any disclosure, copying or unauthorized use of such information is prohibited. If you receive this message in error, please notify us immediately and delete the original and any copies and attachments.
    </div>
    `}function handleShowMore(e){e.preventDefault();var t=document.querySelectorAll(".hidden-attachment");0<t.length?(t.forEach(e=>{e.classList.remove("hidden-attachment")}),e.target.textContent="hide attachments"):(attachmentsContainer.querySelectorAll(".alert").forEach((e,t)=>{1<t&&e.classList.add("hidden-attachment")}),updateShowMoreText())}function setupAttachments(){attachmentsContainer&&([{name:"report.docx",type:"primary"},{name:"presentation.pptx",type:"primary"},{name:"data.xlsx",type:"primary"}].forEach((e,t)=>{var s=document.createElement("div");s.className=`alert m-0 p-0 badge bg-${e.type}-50 border-${e.type} ps-2 `+(0<t?"hidden-attachment":""),s.innerHTML=`${e.name} <button data-bs-dismiss="alert" class="btn btn-icon btn-xs ms-1 rounded-0 border border-${e.type} border-top-0 border-bottom-0 border-end-0" type="button">
            <i class="fas fa-times"></i>
        </button>`,attachmentsContainer.insertBefore(s,showMoreButton)}),updateShowMoreText())}function updateShowMoreText(){var e;showMoreButton&&(0<(e=document.querySelectorAll(".hidden-attachment")).length?(showMoreButton.textContent=`show ${e.length} more`,showMoreButton.style.display=""):showMoreButton.style.display="none")}function loadEmails(){fetch("./json/MOCK_MAIL.json").then(e=>{if(e.ok)return e.json();throw new Error("Network response was not ok "+e.statusText)}).then(e=>{emailList?(localStorage.setItem("emails",JSON.stringify(e)),emailList.innerHTML="",e.forEach((e,t)=>{var s=document.createElement("li"),n=(s.className=(`${e.read?"":"unread"} `+(e.starred?"starred":"")).trim(),s.style.cursor="pointer","msg-"+e.id),a=new Date(e.timestamp).toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0});s.innerHTML=`
                <div class="d-flex align-items-center px-3 px-sm-4 py-2 py-lg-0 height-4 height-mobile-auto gap-2">
                    <div class="form-check form-check-hitbox me-2 order-1 mb-0">
                        <input type="checkbox" class="form-check-input" id="${n}">
                        <label class="form-check-label" for="${n}"></label>
                    </div>
                    <div class="d-flex align-self-end align-self-lg-center order-3 order-lg-2 me-lg-3 me-0 mb-1 mb-lg-0 flex-shrink-0">
                        <svg class="mail-starred sa-icon">
                            <use href="img/sprite.svg#star"></use>
                        </svg>
                    </div>
                    <div class="js-email-content d-flex flex-column flex-lg-row flex-grow-1 align-items-stretch order-2 order-lg-3" style="min-width: 0;">
                        <div class="mail-sender flex-shrink-0 align-self-start align-self-lg-center width-sm width-max-sm text-truncate">${e.sender}</div>
                        <div class="d-flex flex-column flex-lg-row flex-grow-1 w-100 overflow-hidden">
                            <div class="mail-subject flex-shrink-0 align-self-start align-self-lg-center me-2 text-truncate width-max-100">${e.subject}</div>
                            <div class="d-flex align-items-center flex-grow-1 w-100 overflow-hidden">
                                <div class="mail-body d-block text-truncate w-100 pe-lg-5 text-muted">
                                    <span class="hidden-sm">-</span> ${e.bodyPreview}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="fs-sm text-muted ms-auto hide-on-hover-parent order-4 position-on-mobile-absolute pos-top pos-right pt-1 pt-lg-0 mt-2 me-3 me-sm-4 mt-lg-0 me-lg-0 flex-shrink-0">${a}</div>
                </div>
            `,s.querySelector(".form-check-input").addEventListener("click",e=>{e.stopPropagation()}),emailList.appendChild(s)})):console.error("Email list container not found!")}).catch(e=>console.error("Error loading emails:",e))}document.addEventListener("DOMContentLoaded",function(){initializeElements(),loadEmails(),setupEventListeners(),setupAttachments()});
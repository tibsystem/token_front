const utils={debounce:(e,r)=>{let i;return(...t)=>{clearTimeout(i),i=setTimeout(()=>e(...t),r)}},parseValues:t=>"string"==typeof t?t.split(",").map(t=>{t=parseFloat(t.trim());return isNaN(t)?null:t}).filter(t=>null!==t):Array.isArray(t)?t.filter(t=>!isNaN(t)&&null!==t):[0],parseDimension:(t,e)=>{return"auto"===t?e:"number"==typeof t?Math.round(t):"string"!=typeof t||(t=parseFloat(t),isNaN(t))?e:Math.round(t)},clamp:(t,e,r)=>Math.min(Math.max(t,e),r),isValidColor:t=>{var e;return!(!t||"string"!=typeof t)&&((e=(new Option).style).color=t,""!==e.color)}},defaultOptions={type:"line",width:"auto",height:"auto",lineColor:"var(--primary-500)",fillColor:"var(--primary-100)",lineWidth:2,barColor:"var(--primary-500)",negBarColor:"var(--danger-500)",zeroBarColor:"var(--bs-secondary)",barWidth:4,barSpacing:1,posBarColor:"var(--success-500)",thresholdColor:"var(--bs-secondary)",thresholdValue:0,sliceColors:["var(--primary-500)","var(--danger-500)","var(--bs-success)","var(--info-500)","var(--bs-warning)"],disableTooltips:!1,tooltipPrefix:"",tooltipSuffix:"",tooltipOffsetX:10,tooltipOffsetY:-20,responsive:!0};function streamline(e,t,r={}){try{if(!(e="string"==typeof e?document.querySelector(e):e)instanceof Element)throw new Error("Invalid element provided");Array.isArray(t)||"object"!=typeof t||(r=t,t=void 0),t=t||utils.parseValues(e.getAttribute("data-values")||e.textContent),r={...defaultOptions,...r},e.chartData&&cleanupChart(e.chartData);var i=initializeSVG(e,r)["svg"],o={element:e,svg:i,values:t,options:r,pointCoordinates:[]};return e.chartData=o,drawChart(i,t,r),setupAccessibility(e,r,t),r.disableTooltips||addInteraction(o),r.responsive&&setupResponsive(o),e}catch(t){return console.error("Streamline initialization failed:",t),e}}function cleanupChart(t){var{element:e,svg:r}=t;t.resizeHandler&&window.removeEventListener("resize",t.resizeHandler),t.zoomHandler&&window.removeEventListener("wheel",t.zoomHandler),t.tooltip&&(t.tooltip.remove(),r.removeEventListener("mousemove",t.mouseMoveHandler),r.removeEventListener("mouseout",t.mouseOutHandler),r.removeEventListener("mouseleave",t.mouseLeaveHandler)),e.chartData=null}function initializeSVG(t,e){t.innerHTML="";var r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=window.getComputedStyle(t),o=t.offsetWidth||parseFloat(i.width)||100,i=t.offsetHeight||parseFloat(i.height)||30,o=utils.parseDimension(e.width,o),e=utils.parseDimension(e.height,i),i=window.devicePixelRatio||1,n=e*i,n=(r.setAttribute("width",o*i),r.setAttribute("height",n),r.setAttribute("viewBox",`0 0 ${o} `+e),r.setAttribute("preserveAspectRatio","xMidYMid meet"),r.style.display="block",r.style.overflow="visible",document.createElementNS("http://www.w3.org/2000/svg","g"));return n.setAttribute("shape-rendering","crispEdges"),n.setAttribute("stroke-width",(1/i).toString()),n.setAttribute("transform",`scale(${i})`),r.appendChild(n),t.appendChild(r),r.scaleFactor=i,{svg:r,chartGroup:n}}function setupAccessibility(t,e,r){t.setAttribute("role","img");var e=generateChartDescription(e,r),r=(t.setAttribute("aria-label",e),"streamline-desc-"+Math.random().toString(36).substr(2,9)),i=document.createElement("span");i.id=r,Object.assign(i.style,{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",border:"0"}),i.textContent=e,document.body.appendChild(i),t.setAttribute("aria-describedby",r)}function generateChartDescription(t,e){var t=t.type.charAt(0).toUpperCase()+t.type.slice(1),r=e.filter(t=>null!==t).length,i=Math.min(...e.filter(t=>null!==t)),e=Math.max(...e.filter(t=>null!==t));return`${t} chart with ${r} data points, ranging from ${i.toFixed(2)} to `+e.toFixed(2)}function setupResponsive(t){const{element:r,svg:i,values:o,options:n}=t;var e=utils.debounce(()=>{var t=window.getComputedStyle(r),e=r.offsetWidth||parseFloat(t.width)||100,t=r.offsetHeight||parseFloat(t.height)||30,e=utils.parseDimension(n.width,e),t=utils.parseDimension(n.height,t);for(i.setAttribute("width",e),i.setAttribute("height",t),i.setAttribute("viewBox",`0 0 ${e} `+t);i.firstChild;)i.removeChild(i.firstChild);drawChart(i,o,n),r.chartData&&(r.chartData.pointCoordinates=[],r.chartData.recachePoints)&&r.chartData.recachePoints()},100);t.resizeHandler=e,window.addEventListener("resize",e)}function drawChart(t,e,r){for(var i=t.querySelector("g")||t;i.firstChild;)i.removeChild(i.firstChild);({line:drawLineChart,bar:drawBarChart,tristate:drawTristateChart,discrete:drawDiscreteChart,pie:drawPieChart}[r.type]||drawLineChart)(t,e,r)}function drawLineChart(t,e,r){var o=parseInt(t.getAttribute("width"))/(t.scaleFactor||1);const n=parseInt(t.getAttribute("height"))/(t.scaleFactor||1);var a=e.filter(t=>null!==t&&!isNaN(t));if(a.length){const l=Math.min(...a);a=Math.max(...a),a=a===l?a||1:a-l;const s=(o-8)/Math.max(1,e.length-1),d=(n-8)/a;for(;t.firstChild;)"defs"!==t.firstChild.tagName&&t.removeChild(t.firstChild);a=document.createElementNS("http://www.w3.org/2000/svg","g");t.appendChild(a);const h=[],p=[];let i=[];p.push("4,"+(n-4)),e.forEach((t,e)=>{var r;null===t||isNaN(t)?i.push(null):(e=4+e*s,r=n-4-(t-l)*d,h.push(e+","+r),p.push(e+","+r),i.push({x:e,y:r,value:t}))}),p.push(o-4+","+(n-4)),r.fillColor&&((e=document.createElementNS("http://www.w3.org/2000/svg","polygon")).setAttribute("points",p.join(" ")),e.setAttribute("fill",r.fillColor),e.setAttribute("stroke","none"),a.appendChild(e));o=document.createElementNS("http://www.w3.org/2000/svg","polyline");o.setAttribute("points",h.join(" ")),o.setAttribute("fill","none"),o.setAttribute("stroke",r.lineColor),o.setAttribute("stroke-width",r.lineWidth.toString()),o.setAttribute("stroke-linecap","round"),o.setAttribute("stroke-linejoin","round"),o.setAttribute("vector-effect","non-scaling-stroke"),a.appendChild(o),t.pointCoordinates=i}}function drawBarChart(t,e,d){var r=t.scaleFactor||1,i=parseInt(t.getAttribute("width"))/r;const h=parseInt(t.getAttribute("height"))/r;r=e.filter(t=>null!==t&&!isNaN(t));if(r.length){for(;t.firstChild;)"defs"!==t.firstChild.tagName&&t.removeChild(t.firstChild);var o=Math.min(0,...r),n=Math.max(...r),n=n===o?n||1:n-o,r=r.length;const p=Math.max(1,Math.min(d.barWidth,(i-4)/r-d.barSpacing)),u=(h-4)/n,c=document.createElementNS("http://www.w3.org/2000/svg","g"),g=(c.setAttribute("vector-effect","non-scaling-stroke"),t.appendChild(c),h-2-(0-o)*u);let l=0,s=[];e.forEach((t,e)=>{var r,i,o,n,a;null===t||isNaN(t)?s.push(null):(r=Math.max(0,2+l*(p+d.barSpacing)),i=Math.max(1,Math.abs(t*u)),o=0<=t?Math.min(h-i,g-i):Math.min(h-i,g),n=t<0?d.negBarColor:0===t?d.zeroBarColor:d.barColor,(a=document.createElementNS("http://www.w3.org/2000/svg","rect")).setAttribute("x",r.toString()),a.setAttribute("y",o.toString()),a.setAttribute("width",p.toString()),a.setAttribute("height",i.toString()),a.setAttribute("fill",n),a.setAttribute("shape-rendering","crispEdges"),c.appendChild(a),s.push({x:r+p/2,y:o+i/2,value:t,barLeft:r,barTop:o,barWidth:p,barHeight:i}),l++)}),t.pointCoordinates=s}}function drawTristateChart(t,e,l){var r=parseInt(t.getAttribute("width"))||parseInt(t.closest("svg").getAttribute("width")),i=parseInt(t.getAttribute("height"))||parseInt(t.closest("svg").getAttribute("height"));var o=e.filter(t=>null!==t&&!isNaN(t));if(o.length){o=o.length;const s=Math.max(1,Math.min(l.barWidth,(r-4)/o-l.barSpacing)),d=Math.max(1,(i-4)/3),h=2+(i-4)/2,p=document.createElementNS("http://www.w3.org/2000/svg","g");t.appendChild(p);let n=0,a=[];e.forEach((r,t)=>{if(null!==r){var i=Math.max(0,2+n*(s+l.barSpacing));let t,e;e=-1===r?(t=h,l.negBarColor):0===r?(t=h-d/2,l.zeroBarColor):(t=h-d,l.posBarColor);var o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("x",i.toString()),o.setAttribute("y",t.toString()),o.setAttribute("width",s.toString()),o.setAttribute("height",d.toString()),o.setAttribute("fill",e),p.appendChild(o),a.push({x:i+s/2,y:t+d/2,value:r,barLeft:i,barTop:t,barWidth:s,barHeight:d}),n++}else a.push(null)}),t.pointCoordinates=a}}function drawDiscreteChart(t,e,s){var r=parseInt(t.getAttribute("width")),i=parseInt(t.getAttribute("height"));var o=e.filter(t=>null!==t&&!isNaN(t));if(o.length){const d=Math.min(...o);var n=Math.max(...o);const h=n===d?n||1:n-d,p=(r-4)/Math.max(1,o.length-1);n=(i-4)/h;const u=Math.round(.3*i),c=i-u,g=document.createElementNS("http://www.w3.org/2000/svg","g");t.appendChild(g),void 0!==s.thresholdValue&&s.thresholdColor&&(o=i-2-(s.thresholdValue-d)*n,(i=document.createElementNS("http://www.w3.org/2000/svg","line")).setAttribute("x1",2),i.setAttribute("y1",o),i.setAttribute("x2",r-2),i.setAttribute("y2",o),i.setAttribute("stroke",s.thresholdColor),i.setAttribute("stroke-width",1),g.appendChild(i));let a=0,l=[];e.forEach((t,e)=>{var r,i,o,n;null!==t?(r=2+a*p,i=Math.round(c-c*((t-d)/h)),o=void 0!==s.thresholdValue&&t<s.thresholdValue?s.thresholdColor:s.lineColor,(n=document.createElementNS("http://www.w3.org/2000/svg","line")).setAttribute("x1",r),n.setAttribute("y1",i),n.setAttribute("x2",r),n.setAttribute("y2",i+u),n.setAttribute("stroke",o),n.setAttribute("stroke-width",s.lineWidth),g.appendChild(n),l.push({x:r,y:i+u/2,value:t,lineTop:i,lineHeight:u}),a++):l.push(null)}),t.pointCoordinates=l}}function drawPieChart(t,e,d){var r=parseInt(t.getAttribute("width")),i=parseInt(t.getAttribute("height")),e=e.filter(t=>null!==t&&0<t);if(e.length){const h=e.reduce((t,e)=>t+e,0),p=Math.min(r,i)/2-2,u=r/2,c=i/2,g=document.createElementNS("http://www.w3.org/2000/svg","g");t.appendChild(g);let s=0;const b=[];e.forEach((t,e)=>{var r=t/h*Math.PI*2,i=s+r,e=d.sliceColors[e%d.sliceColors.length],o=u+p*Math.cos(s),n=c+p*Math.sin(s),a=u+p*Math.cos(i),l=c+p*Math.sin(i),r=r>Math.PI?1:0,o=[`M ${u} `+c,`L ${o} `+n,`A ${p} ${p} 0 ${r} 1 ${a} `+l,"Z"].join(" "),n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",o),n.setAttribute("fill",e),n.setAttribute("stroke","none"),g.appendChild(n),b.push({startAngle:s,endAngle:i,value:t,color:e}),s=i}),t.sliceInfo=b,t.pointCoordinates=[{centerX:u,centerY:c,radius:p,sliceInfo:b.map((t,e)=>({...t,index:e}))}]}}function addInteraction(t){const{svg:p,values:u,options:v}=t;let e=null,s=-1,c=null,d=!1,n=null,w=-1,C=null,a=100,l=30;const A=p.pointCoordinates||[],h=()=>(e||(console.log("Creating tooltip"),e=document.createElement("div"),Object.assign(e.style,{position:"fixed",padding:"6px 10px",backgroundColor:"rgba(0, 0, 0, 0.9)",color:"#fff",borderRadius:"4px",fontSize:"13px",fontFamily:"Arial, sans-serif",pointerEvents:"none",zIndex:"10000",opacity:"0",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",gap:"6px",transition:"opacity 0.1s ease, left 0.1s ease, top 0.1s ease"}),document.body.appendChild(e),t.tooltip=e),e),g=(t,e)=>"pie"===v.type&&A[0]?.sliceInfo[t]?A[0].sliceInfo[t].color:"bar"===v.type?v.barColors?e<0?v.barColors.negative:0===e?v.barColors.zero:v.barColors.positive:e<0?v.negBarColor:0===e?v.zeroBarColor:v.barColor:"tristate"===v.type?-1===e?v.negBarColor:0===e?v.zeroBarColor:v.posBarColor:"discrete"===v.type&&void 0!==v.thresholdValue&&e<v.thresholdValue?v.thresholdColor:v.lineColor,b=t=>{var e,r,i,o,n,a,l,s,d,h;c&&(c.remove(),c=null),t<0||("pie"===v.type?({centerX:e,centerY:o,radius:i,sliceInfo:d}=A[0],d[t]&&({startAngle:d,endAngle:s,color:r}=d[t],n=e+(i=1.03*i)*Math.cos(d),l=o+i*Math.sin(d),a=e+i*Math.cos(s),h=o+i*Math.sin(s),e=[`M ${e} `+o,`L ${n} `+l,`A ${i} ${i} 0 ${s-d>Math.PI?1:0} 1 ${a} `+h,"Z"].join(" "),(o=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",e),o.setAttribute("fill",r),o.setAttribute("opacity","0.7"),p.appendChild(o),c=o)):"bar"===v.type?(n=A[t])&&({barLeft:l,barTop:i,barWidth:s,barHeight:d}=n,a=u[t],h=g(t,a),(e=document.createElementNS("http://www.w3.org/2000/svg","rect")).setAttribute("x",l.toString()),e.setAttribute("y",i.toString()),e.setAttribute("width",s.toString()),e.setAttribute("height",d.toString()),e.setAttribute("fill",h),e.setAttribute("opacity","0.7"),p.appendChild(e),c=e):"tristate"===v.type?(r=A[t])&&({barLeft:o,barTop:n,barWidth:a,barHeight:l}=r,i=u[t],s=g(t,i),(d=document.createElementNS("http://www.w3.org/2000/svg","rect")).setAttribute("x",o.toString()),d.setAttribute("y",n.toString()),d.setAttribute("width",a.toString()),d.setAttribute("height",l.toString()),d.setAttribute("fill",s),d.setAttribute("opacity","0.7"),p.appendChild(d),c=d):"discrete"===v.type?(h=A[t])&&({x:e,lineTop:r,lineHeight:i}=h,o=u[t],n=g(t,o),(a=document.createElementNS("http://www.w3.org/2000/svg","line")).setAttribute("x1",e.toString()),a.setAttribute("y1",r.toString()),a.setAttribute("x2",e.toString()),a.setAttribute("y2",(r+i).toString()),a.setAttribute("stroke",n),a.setAttribute("stroke-width",(v.lineWidth+1).toString()),p.appendChild(a),c=a):"line"===v.type&&(l=A[t])&&({x:s,y:d}=l,(h=document.createElementNS("http://www.w3.org/2000/svg","circle")).setAttribute("cx",s.toString()),h.setAttribute("cy",d.toString()),h.setAttribute("r","5"),h.setAttribute("fill",v.lineColor),h.setAttribute("fill-opacity","0.3"),h.setAttribute("stroke",v.lineColor),h.setAttribute("stroke-width","2"),p.appendChild(h),c=h))},f=t=>{var e,r,i,o,n=h();return n.innerHTML="","pie"===v.type?!(t<0||!A[0]?.sliceInfo[t]||({value:o,color:i}=A[0].sliceInfo[t],e=(o/u.reduce((t,e)=>t+(e||0),0)*100).toFixed(1),r=document.createElement("span"),Object.assign(r.style,{display:"inline-block",width:"10px",height:"10px",borderRadius:"50%",backgroundColor:i}),(i=document.createElement("span")).innerHTML=""+v.tooltipPrefix+o.toFixed(2)+v.tooltipSuffix+` <small>(${e}%)</small>`,n.appendChild(r),n.appendChild(i),console.log("Pie tooltip updated: "+o),0)):!(t<0||!A[t]||(e=A[t]["value"],r=g(t,e),i=document.createElement("span"),Object.assign(i.style,{display:"inline-block",width:"10px",height:"10px",borderRadius:"50%",backgroundColor:r}),o=document.createElement("span"),"tristate"===v.type?o.textContent=(1===e?"Positive":-1===e?"Negative":"Neutral")+": "+v.tooltipPrefix+e+v.tooltipSuffix:o.textContent=""+v.tooltipPrefix+("number"==typeof e?e.toFixed(2):e)+v.tooltipSuffix,n.appendChild(i),n.appendChild(o),console.log("Tooltip updated: "+e),0))},m=(i,o)=>{n=n||setTimeout(()=>{n=null;var r=h();if(r&&d){let t=i+v.tooltipOffsetX,e=o+v.tooltipOffsetY;t+a>window.innerWidth&&(t=i-a-5),(e=e+l>window.innerHeight?o-l-5:e)<0&&(e=o+15),r.style.left=t+"px",r.style.top=e+"px",a=r.offsetWidth||a,l=r.offsetHeight||l,console.log(`Tooltip positioned at (${t}, ${e})`)}},10)},y=()=>{clearTimeout(n),n=null,h().style.opacity="0",b(-1),s=-1,d=!1,console.log("Tooltip hidden")};var r=t=>{var e=p.getBoundingClientRect(),r=t.clientX-e.left,i=t.clientY-e.top;let o=1,n=1;var a=p.getAttribute("viewBox"),a=(a?4===(a=a.split(" ").map(parseFloat)).length&&(o=a[2]/e.width,n=a[3]/e.height):(a=parseInt(p.getAttribute("width")),l=parseInt(p.getAttribute("height")),a&&l&&(o=a/e.width,n=l/e.height)),r*o),l=((i,o)=>{if(!A||0===A.length)return console.log("No point coordinates available"),-1;if("pie"===v.type){if(A[0]?.sliceInfo){var{centerX:t,centerY:r,radius:n,sliceInfo:a}=A[0],t=i-t,r=o-r,e=Math.sqrt(t*t+r*r);if(!(n<e)){let e=Math.atan2(r,t);e<0&&(e+=2*Math.PI);n=Math.PI/180;if(null!==C&&Math.abs(e-C)<n)return w;C=e;for(let t=0;t<a.length;t++){var{startAngle:l,endAngle:s}=a[t];if(e>=l&&e<=s)return console.log(`Pie slice ${t} detected`),t}}}else console.log("No slice info for pie chart");return-1}if("bar"===v.type||"tristate"===v.type){for(let t=0;t<A.length;t++){var d=A[t];if(d){var{barLeft:d,barTop:h,barWidth:p,barHeight:u}=d;if(d-5<=i&&i<=d+p+5&&h-5<=o&&o<=h+u+5)return console.log(`Bar/tristate point ${t} detected`),t}}return-1}if("discrete"===v.type){for(let t=0;t<A.length;t++){var c=A[t];if(c){var g=Math.max(15,4*v.lineWidth),b=c.lineHeight;if(Math.abs(i-c.x)<=g/2&&o>=c.lineTop&&o<=c.lineTop+b)return console.log(`Discrete point ${t} detected`),t}}return-1}let f=1/0,m=-1;return A.forEach((t,e)=>{var r;t&&void 0!==t.x&&void 0!==t.y&&(r=i-t.x,t=o-t.y,(r=Math.sqrt(r*r+t*t))<f)&&r<=20&&(f=r,m=e)}),0<=m&&console.log(`Line point ${m} detected`),m})(a,i*n);!(0<=l)||(e=l,r=t.clientX,a=t.clientY,e<0)||"pie"!==v.type&&!A[e]||"pie"===v.type&&!A[0]?.sliceInfo[e]?(y(),w=-1):(e===w&&d||(w=e,f(e)&&(h().style.opacity="1",d=!0,s=e,b(e))),m(r,a))},i=t=>{var e=p.getBoundingClientRect();(t.clientX<e.left||t.clientX>e.right||t.clientY<e.top||t.clientY>e.bottom)&&(y(),w=-1)},o=()=>{y(),w=-1};t.recachePoints=()=>{drawChart(p,u,v),y(),w=-1},t.mouseMoveHandler=r,t.mouseOutHandler=i,t.mouseLeaveHandler=o,p.addEventListener("mousemove",r),p.addEventListener("mouseout",i),p.addEventListener("mouseleave",o),console.log("Interaction handlers added to SVG")}function initStreamlines(){var t;"undefined"!=typeof document&&(t=()=>{document.querySelectorAll(".streamline").forEach(t=>{if(!t.querySelector("svg")){var e,r,i={type:t.dataset.type||"line"};window.getComputedStyle(t);for([e,r]of Object.entries(t.dataset)){var o=e.replace(/^data-/,"").replace(/-./g,t=>t[1].toUpperCase());if(r&&"string"==typeof r&&r.includes("var(")){var n=document.createElement("div"),a=(n.style.color=r,document.body.appendChild(n),window.getComputedStyle(n).color);document.body.removeChild(n),i[o]=a}else try{i[o]=JSON.parse(r)}catch{i[o]=r}}streamline(t,i)}})},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t())}export{streamline,initStreamlines};